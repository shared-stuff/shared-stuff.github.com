(function(){var b,f,e,c,a=Object.prototype.hasOwnProperty;b=function(a,d){var c,b;b=[];for(c=a;a<=d?c<=d:c>=d;a<=d?c++:c--)b.push(String.fromCharCode(c));return b};e=function(){var a;a=[];for(c=0;9>=c;c++)a.push(""+c);return a}().concat(b(65,90)).concat(b(97,122));f=function(a){return a[Math.floor(Math.random()*a.length)]};this.utils={log:function(a){return console.log(a)},focus:function(a){return setTimeout(function(){return $("#"+a).focus()},100)},cleanObjectFromAngular:function(c){var d,b,e,f,
j;j=[];e=0;for(f=c.length;e<f;e++)d=c[e],j.push(function(){var c;c=[];for(b in d)a.call(d,b)&&(0<=b.indexOf("$$")?c.push(delete d[b]):c.push(void 0));return c}());return j},randomString:function(a){var d,c;c=[];for(d=0;0<=a?d<=a:d>=a;0<=a?d++:d--)c.push(f(e));return c.join("")},doNothing:function(){},defer:function(a){return setTimeout(function(){return a()},1)},isBlank:function(a){return!a||/^\s*$/.test(a)},focusAndSelect:function(a){return setTimeout(function(){return $("#"+a).focus().select},100)}}}).call(this);var remoteStorageUtils=function(){function b(a,b,d,k){var f=JSON.parse(localStorage.getItem(c)),i=localStorage.getItem(e);remoteStorage.createClient(f,a,i).put(b,d,function(c){c?(console.log('Could not store "'+b+'" in "'+a+'" category'),console.log(c)):console.log('Stored "'+d+'" for key "'+b+'" in "'+a+'" category');k&&k(c)})}var f,e="remoteStorageToken",c="userStorageInfo";window.addEventListener("message",function(a){a.origin==location.protocol+"//"+location.host&&(console.log("Received an OAuth token: "+
a.data),localStorage.setItem(e,a.data),f(a.data))},!1);return{connect:function(a,b){remoteStorage.getStorageInfo(a,function(a,e){a?(alert("Could not load storage info"),console.log(a)):(console.log("Storage info received:"),console.log(e),localStorage.setItem(c,JSON.stringify(e)));b(a,e)})},authorize:function(a,b){f=b;var d=JSON.parse(localStorage.getItem(c)),e=location.href.substring(0,location.href.length-location.hash.length).replace(/\/[^\/]*$/,"")+"/remote-storage-login-popup.html";console.log("RedirectUrl: "+
e);d=remoteStorage.createOAuthAddress(d,a,e);window.open(d)},getItem:function(a,b,d){var f=JSON.parse(localStorage.getItem(c));if("public"==a)f=remoteStorage.createClient(f,"public");else var h=localStorage.getItem(e),f=remoteStorage.createClient(f,a,h);f.get(b,function(c,e){c?console.log(c):void 0==e?console.log("There wasn't anything for \""+b+'" in category "'+a+'"'):console.log('We received this for key "'+b+'" in category "'+a+'": '+e);d(c,e)})},setItem:b,isLoggedOn:function(a){(!localStorage.getItem(c)||
!localStorage.getItem(e))&&a(!1);try{b("sharedstuff","loggedOnTest","test",function(d){a(!d)})}catch(f){a(!1)}},deleteToken:function(){localStorage.removeItem(e)}}}();(function(){var b,f;f=function(){function b(c){var a;this.title=(null!=c?c.title:void 0)||"";this.description=(null!=c?c.description:void 0)||"";a=(new Date).getTime();this.id=(null!=c?c.id:void 0)||""+a;this.created=(null!=c?c.created:void 0)||a;this.modified=(null!=c?c.modified:void 0)||this.created}b.prototype.modify=function(){return this.modified=(new Date).getTime()};return b}();b=function(){function b(c){c=c||{};this.id=c.id||""+(new Date).getTime();this.name=c.name||c.userAddress||"";this.userAddress=
c.userAddress||"";this.secret=c.secret||""}b.prototype.sanitize=function(){if(utils.isBlank(this.name))return this.name=this.userAddress};return b}();this.Stuff=f;this.Friend=b}).call(this);(function(){var b,f,e,c,a,g,d,k,h,i=Object.prototype.hasOwnProperty,j=function(a,d){function c(){this.constructor=a}for(var b in d)i.call(d,b)&&(a[b]=d[b]);c.prototype=d.prototype;a.prototype=new c;a.__super__=d.prototype;return a};d=utils.log;g=utils.doNothing;k=utils.randomString;a=utils.defer;h=remoteStorageUtils;e=function(){function d(a,c){this.category=a;this.key=c}d.prototype.readAllItems=function(d){var c;c=this;return c.dataCache?a(function(){return d(c.dataCache.items)}):h.getItem(this.category,
this.key,function(a,b){c.dataCache=JSON.parse(b||'{"items":[]}');return d(c.dataCache.items)})};d.prototype.findItemByID=function(a,d){return _.find(a,function(a){return a.id===d})};d.prototype.list=function(a){return this.readAllItems(a)};d.prototype.getItem=function(a,d){return this.readAllItems(function(c){return d(_.find(c,function(d){return d.id===a}))})};d.prototype.save=function(a,d){utils.cleanObjectFromAngular(a);this.dataCache||(this.dataCache={});this.dataCache.items=a;return h.setItem(this.category,
this.key,JSON.stringify(this.dataCache),d)};d.prototype.saveItem=function(a,d){var c;c=this;return this.readAllItems(function(b){var e;(e=c.findItemByID(b,a.id))?b[_.indexOf(b,e)]=a:b.push(a);return c.save(b,d)})};d.prototype.deleteItem=function(a,d){var c;c=this;return this.readAllItems(function(b){var e;e=c.findItemByID(b,a);return c.save(_.without(b,e),d)})};return d}();f=function(a){function d(a,c,b){this.category=a;this.key=c;this.settingsDAO=b}j(d,a);d.prototype.save=function(a,c){d.__super__.save.call(this,
a,c);return this.settingsDAO.getSecret(function(d){return h.setItem("public","sharedstuff-"+d,JSON.stringify(a),g)})};return d}(e);(function(){function a(d){this.key=d}a.prototype.readAllItems=function(){return JSON.parse(localStorage.getItem(this.key)||"[]")};a.prototype.findItemByID=function(a,d){return _.find(a,function(a){return a.id===d})};a.prototype.list=function(a){return a(this.readAllItems())};a.prototype.getItem=function(a,d){return d(_.find(this.readAllItems(),function(d){return d.id===
a}))};a.prototype.save=function(a){utils.cleanObjectFromAngular(a);return localStorage.setItem(this.key,JSON.stringify(a))};a.prototype.saveItem=function(a){var d,c;d=this.readAllItems();c=this.findItemByID(d,a.id);d[_.indexOf(d,c)]=a;return this.save(d)};a.prototype.deleteItem=function(a){var d;d=this.readAllItems();a=this.findItemByID(d,a);return this.save(_.without(d,a))};return a})();c=function(){function d(){this.settings=null;this.key="settings"}d.prototype.readSettings=function(d){var c;c=
this;return c.settings?a(function(){return d(c.settings)}):h.getItem("sharedstuff",c.key,function(a,b){var e;e=JSON.parse(b||"{}");c.settings=e;if(e.secret)return d(e);e.secret=k(20);return h.setItem("sharedstuff",c.key,JSON.stringify(e),function(){return d(e)})})};d.prototype.getSecret=function(a){return this.readSettings(function(d){return a(d.secret)})};return d}();b=function(){function a(d){this.friendDAO=d;this.friendsStuffList=[]}a.prototype.listStuffByFriend=function(a,c){if(a.userAddress)return remoteStorage.getStorageInfo(a.userAddress,
function(b,e){var f;f=remoteStorage.createClient(e,"public");return e?f.get("sharedstuff-"+a.secret,function(a,d){return d?c(JSON.parse(d||"[]")):c([])}):d(b)})};a.prototype.validateFriend=function(a,c){return utils.isBlank(a.userAddress)?c(["userAddress"]):remoteStorage.getStorageInfo(a.userAddress,function(b,e){var f;if(e)return f=remoteStorage.createClient(e,"public"),f.get("sharedstuff-"+a.secret,function(a,b){if(b)return c([]);d(a);return c(["secret"])});d(b);return c(["userAddress"])})};a.prototype.list=
function(a){var d;d=this;return this.friendDAO.list(function(c){var b,e,f,k,h;h=[];f=0;for(k=c.length;f<k;f++)e=c[f],b=function(c){return function(b){d._updateWithLoadedItems(c,b);return a(d.friendsStuffList)}},h.push(d.listStuffByFriend(e,b(e)));return h})};a.prototype._updateWithLoadedItems=function(a,d){var c,b,e,f,h;h=[];e=0;for(f=d.length;e<f;e++)b=d[e],b.owner=a,(c=_.find(this.friendsStuffList,function(a){return a.id===b.id}))?h.push(this.friendsStuffList[_.indexOf(this.friendsStuffList,c)]=
b):h.push(this.friendsStuffList.push(b));return h};return a}();e=new e("sharedstuff","myFriendsList");c=new c;angular.module("myApp.services",[]).value("version","0.1").value("settingsDAO",c).value("stuffDAO",new f("sharedstuff","myStuffList",c)).value("friendDAO",e).value("friendsStuffDAO",new b(e))}).call(this);(function(){var b,f,e;f=utils.log;e=function(c){return!_.any(["invitation","login"],function(a){return 1===c.indexOf(a)})};b=function(c,a){var b;c.logout=function(){remoteStorageUtils.deleteToken();c.session={userAddress:null,isLoggedIn:!1};return a.path("/login")};c.setLoggenOn=function(){c.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!0};return c.$digest()};b=function(){var d;d=a.path();f(d);if(!c.session.isLoggedIn&&e(a.path()))return sessionStorage.setItem("targetPath",
d),a.path("/login")};return remoteStorageUtils.isLoggedOn(function(a){a?c.setLoggenOn():(c.session={userAddress:null,isLoggedIn:!1},b());return c.$on("$beforeRouteChange",b)})};b.$inject=["$scope","$location","settingsDAO"];this.AppController=b}).call(this);(function(){var b,f,e,c,a,g;a=utils.focus;g=utils.focusAndSelect;e=function(d,b,e,f,j){var l;d.friendList=[];d.isAddFriendFormHidden=!0;d.isInviteFriendFormHidden=!0;l=d.session;d.inviteUrl="Loading...";b.list(function(a){d.friendList=a;d.isAddFriendFormHidden=0<d.friendList.length;j.userAddress&&(d.friend=new Friend({userAddress:j.userAddress,secret:j.secret}),d.isAddFriendFormHidden=!1);return d.$digest()});d.showAddForm=function(){d.isAddFriendFormHidden=!1;d.isInviteFriendFormHidden=!0;return a("name")};
d.friend=new Friend;d.addFriend=function(){d.friend.sanitize();return e.validateFriend(d.friend,function(c){if(0===c.length)return d.friendList.push(new Friend(d.friend)),b.save(d.friendList),d.friend=new Friend,d.isAddFriendFormHidden=!0,d.$digest(),a("showAddFriendFormButton");d.showValidationErrors=!0;return window.alert(c.join(",")+" seems invalid")})};d.inviteFriend=function(){d.isInviteFriendFormHidden=!1;d.isAddFriendFormHidden=!0;return f.getSecret(function(a){d.inviteUrl=c(l.userAddress,
a);d.$digest();return g("inviteUrl")})};d.closeInviteFriend=function(){return d.isInviteFriendFormHidden=!0};return a("showAddFriendFormButton")};c=function(a,c){var b;b=window.location;return b.protocol+"//"+b.host+b.pathname+"#"+("/invitation/"+a+"/"+c)};e.$inject=["$scope","friendDAO","friendsStuffDAO","settingsDAO","$routeParams"];b=function(a,c,b,e,f){var g;a.friend=new Friend;a.editMode=!1;a.stuffList=[];a.showValidationErrors=!0;c.getItem(e.id,function(c){a.friend=new Friend(c);a.$digest();
return b.listStuffByFriend(c,function(c){a.stuffList=c;return a.$digest()})});g=function(){return a.$apply(function(){return f.path("/friends")})};a.save=function(){a.friend.sanitize();return b.validateFriend(a.friend,function(b){return 0===b.length?c.saveItem(a.friend,g):window.alert(b.join(",")+" seems invalid")})};a.showEditMode=function(){return a.editMode=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete your friend "'+a.friend.name+'"?'))return c.deleteItem(a.friend.id,
g)}};b.$inject=["$scope","friendDAO","friendsStuffDAO","$routeParams","$location"];f=function(a,c,b,e,f){var g;a.stuffList=[];g=new Friend({userAddress:e.userAddress,secret:e.secret});a.friend=g;b.listStuffByFriend(g,function(c){a.stuffList=c;return a.$digest()});return a.addFriend=function(){return f.path("/addFriend/"+g.userAddress+"/"+g.secret)}};f.$inject=["$scope","friendDAO","friendsStuffDAO","$routeParams","$location"];this.FriendsController=e;this.FriendEditController=b;this.FriendViewController=
f}).call(this);(function(){var b,f,e,c;e=utils.focus;c=function(a){return!utils.isBlank(a.title)};b=function(a,b){a.stuffList=[];a.isAddStuffFormHidden=!0;b.list(function(d){a.stuffList=d;a.isAddStuffFormHidden=0<a.stuffList.length;return a.$digest()});a.showAddForm=function(){a.isAddStuffFormHidden=!1;return e("title")};a.stuff=new Stuff;a.addStuff=function(){return c(a.stuff)?(a.stuffList.push(new Stuff(a.stuff)),b.save(a.stuffList,function(){}),a.stuff=new Stuff,a.isAddStuffFormHidden=!0,e("showAddStuffFormButton")):
a.showValidationErrors=!0};return e("showAddStuffFormButton")};b.$inject=["$scope","stuffDAO"];f=function(a,b,d,e){var f;a.stuff=new Stuff;b.getItem(d.id,function(d){a.stuff=new Stuff(d);return a.$digest()});f=function(){return a.$apply(function(){return e.path("/mystuff")})};a.save=function(){return c(a.stuff)?(a.stuff.modify(),b.saveItem(a.stuff,f)):a.showValidationErrors=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete this stuff called "'+a.stuff.title+'"?'))return b.deleteItem(a.stuff.id,
f)}};f.$inject=["$scope","stuffDAO","$routeParams","$location"];this.MyStuffController=b;this.MyStuffEditController=f}).call(this);(function(){var b,f;f=utils.log;b=function(b,c,a,g){b.stuffList=[];b.sortAttribute="-modified";b.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};c(function(){return g.list(function(a){b.stuffList=a;return b.$digest()})});return b.sortBy=function(a){f(a);return b.sortAttribute=a}};b.$inject=["$scope","$defer","friendDAO","friendsStuffDAO"];this.FriendsStuffController=b}).call(this);var log=utils.log;function AboutController(b){log("About");log(b.session);b.bla="blase";log(utils.randomString(10))}AboutController.$inject=["$scope"];angular.module("myApp.directives",[]).directive("appVersion",["version",function(b){return function(f,e){e.text(b)}}]).directive("appSelectOnFocus",[function(){return function(b,f){f.bind("focus",function(){f.select()})}}]);angular.module("myApp.filters",[]).filter("interpolate",["version",function(b){return function(f){return(""+f).replace(/\%VERSION\%/mg,b)}}]);(function(){var b,f,e,c;c=utils.focus;b=function(a,c){a.secret="Loading secret ...";return c.getSecret(function(c){a.secret=c;return a.$digest()})};b.$inject=["$scope","settingsDAO"];f=function(a,b,d){return a["export"]=function(){return d.list(function(d){return b.list(function(b){utils.cleanObjectFromAngular(d);utils.cleanObjectFromAngular(b);a.exportedData=JSON.stringify({stuff:d,friends:b});a.$digest();return c("exportTextarea")})})}};f.$inject=["$scope","friendDAO","stuffDAO"];e=function(a,c,
b){a.importDataText="";return a.startImport=function(){var e,f,i;e=JSON.parse(a.importDataText);i=0;f=function(){i--;if(0===i)return window.alert("Import Done!"),a.importDataText=""};null!=e&&e.stuff&&(i++,b.save(e.stuff,f));if(null!=e&&e.friends)return i++,c.save(e.friends,f)}};e.$inject=["$scope","friendDAO","stuffDAO"];this.AccountController=b;this.ExportController=f;this.ImportController=e}).call(this);(function(){var b,f,e;f=utils.log;e=remoteStorageUtils;b=function(c,a){f("Login");c.session.isLoggedIn=!1;c.userAddress="shybyte@owncube.com";return c.login=function(){var b;try{return b=c.userAddress,f("userAddress:"+b),b?e.connect(b,function(){return e.authorize(["public","sharedstuff"],function(){var d;localStorage.setItem("userAddress",b);c.setLoggenOn();d=sessionStorage.getItem("targetPath")||"/";sessionStorage.removeItem("targetPath");return c.$apply(function(){return a.path(d)})})}):alert("Please enter a remote storage id!")}catch(d){return f(d)}}};
b.$inject=["$scope","$location","settingsDAO"];this.LoginController=b}).call(this);angular.module("myApp",["myApp.filters","myApp.services","myApp.directives"]).config(["$routeProvider",function(b){b.when("/login",{template:"partials/login.html",controller:LoginController});b.when("/mystuff",{template:"partials/my-stuff.html",controller:MyStuffController});b.when("/mystuff/:id",{template:"partials/my-stuff-edit.html",controller:MyStuffEditController});b.when("/friends",{template:"partials/friends.html",controller:FriendsController});b.when("/friends/:id",{template:"partials/friend-edit.html",
controller:FriendEditController});b.when("/addFriend/:userAddress/:secret",{template:"partials/friends.html",controller:FriendsController});b.when("/invitation/:userAddress/:secret",{template:"partials/friend.html",controller:FriendViewController});b.when("/friends-stuff",{template:"partials/friends-stuff.html",controller:FriendsStuffController});b.when("/account",{template:"partials/account.html",controller:AccountController});b.when("/export",{template:"partials/account-export.html",controller:ExportController});
b.when("/import",{template:"partials/account-import.html",controller:ImportController});b.when("/settings",{template:"partials/account-settings.html",controller:AccountController});b.when("/about",{template:"partials/about.html",controller:AboutController});b.otherwise({redirectTo:"/friends-stuff"})}]);angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])});
