(function(){var b,e,f,d,c=Object.prototype.hasOwnProperty;b=function(a,c){var b,d;d=[];for(b=a;a<=c?b<=c:b>=c;a<=c?b++:b--)d.push(String.fromCharCode(b));return d};f=function(){var a;a=[];for(d=0;9>=d;d++)a.push(""+d);return a}().concat(b(65,90)).concat(b(97,122));e=function(a){return a[Math.floor(Math.random()*a.length)]};this.utils={log:function(a){return console.log(a)},focus:function(a){return setTimeout(function(){return $("#"+a).focus()},100)},cleanObjectFromAngular:function(a){var b,d,f,e,
j;j=[];f=0;for(e=a.length;f<e;f++)b=a[f],j.push(function(){var a;a=[];for(d in b)c.call(b,d)&&(0<=d.indexOf("$$")?a.push(delete b[d]):a.push(void 0));return a}());return j},randomString:function(a){var c,b;b=[];for(c=0;0<=a?c<=a:c>=a;0<=a?c++:c--)b.push(e(f));return b.join("")},doNothing:function(){},defer:function(a){return setTimeout(function(){return a()},1)},isBlank:function(a){return!a||/^\s*$/.test(a)},focusAndSelect:function(a){return setTimeout(function(){return $("#"+a).focus().select},100)}}}).call(this);var remoteStorageUtils=function(){function b(c,a,b,e){var i=JSON.parse(localStorage.getItem(d)),g=localStorage.getItem(f);remoteStorage.createClient(i,c,g).put(a,b,function(d){d?(console.log('Could not store "'+a+'" in "'+c+'" category'),console.log(d)):console.log('Stored "'+b+'" for key "'+a+'" in "'+c+'" category');e&&e(d)})}var e,f="remoteStorageToken",d="userStorageInfo";window.addEventListener("message",function(c){c.origin==location.protocol+"//"+location.host&&(console.log("Received an OAuth token: "+
c.data),localStorage.setItem(f,c.data),e(c.data))},!1);return{connect:function(c,a){remoteStorage.getStorageInfo(c,function(c,b){c?(alert("Could not load storage info"),console.log(c)):(console.log("Storage info received:"),console.log(b),localStorage.setItem(d,JSON.stringify(b)));a(c,b)})},authorize:function(c,a){e=a;var b=JSON.parse(localStorage.getItem(d)),f=location.href.substring(0,location.href.length-location.hash.length).replace(/\/[^\/]*$/,"")+"/remote-storage-login-popup.html";console.log("RedirectUrl: "+
f);b=remoteStorage.createOAuthAddress(b,c,f);window.open(b)},getItem:function(c,a,b){var e=JSON.parse(localStorage.getItem(d));if("public"==c)e=remoteStorage.createClient(e,"public");else var i=localStorage.getItem(f),e=remoteStorage.createClient(e,c,i);e.get(a,function(d,f){d?console.log(d):void 0==f?console.log("There wasn't anything for \""+a+'" in category "'+c+'"'):console.log('We received this for key "'+a+'" in category "'+c+'": '+f);b(d,f)})},setItem:b,isLoggedOn:function(c){(!localStorage.getItem(d)||
!localStorage.getItem(f))&&c(!1);try{b("sharedstuff","loggedOnTest","test",function(a){c(!a)})}catch(a){c(!1)}},deleteToken:function(){localStorage.removeItem(f)}}}();(function(){var b,e;e=function(){function b(d){var c;this.title=(null!=d?d.title:void 0)||"";this.description=(null!=d?d.description:void 0)||"";c=(new Date).getTime();this.id=(null!=d?d.id:void 0)||""+c;this.created=(null!=d?d.created:void 0)||c;this.modified=(null!=d?d.modified:void 0)||this.created}b.prototype.modify=function(){return this.modified=(new Date).getTime()};return b}();b=function(){function b(d){d=d||{};this.id=d.id||""+(new Date).getTime();this.name=d.name||d.userAddress||"";this.userAddress=
d.userAddress||"";this.secret=d.secret||""}b.prototype.sanitize=function(){if(utils.isBlank(this.name))return this.name=this.userAddress};return b}();this.Stuff=e;this.Friend=b}).call(this);(function(){var b,e,f,d,c,a,h,k,i,g=Object.prototype.hasOwnProperty,j=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a};h=utils.log;a=utils.doNothing;k=utils.randomString;c=utils.defer;i=remoteStorageUtils;f=function(){function a(c,b){this.category=c;this.key=b}a.prototype.readAllItems=function(a){var b;b=this;return b.dataCache?c(function(){return a(b.dataCache.items)}):i.getItem(this.category,
this.key,function(c,d){b.dataCache=JSON.parse(d||'{"items":[]}');return a(b.dataCache.items)})};a.prototype.findItemByID=function(a,c){return _.find(a,function(a){return a.id===c})};a.prototype.list=function(a){return this.readAllItems(a)};a.prototype.getItem=function(a,c){return this.readAllItems(function(b){return c(_.find(b,function(c){return c.id===a}))})};a.prototype.save=function(a,c){utils.cleanObjectFromAngular(a);this.dataCache||(this.dataCache={});this.dataCache.items=a;return i.setItem(this.category,
this.key,JSON.stringify(this.dataCache),c)};a.prototype.saveItem=function(a,c){var b;b=this;return this.readAllItems(function(d){var e;(e=b.findItemByID(d,a.id))?d[_.indexOf(d,e)]=a:d.push(a);return b.save(d,c)})};a.prototype.deleteItem=function(a,c){var b;b=this;return this.readAllItems(function(d){var e;e=b.findItemByID(d,a);return b.save(_.without(d,e),c)})};return a}();e=function(c){function b(a,c,d){this.category=a;this.key=c;this.settingsDAO=d}j(b,c);b.prototype.save=function(c,d){b.__super__.save.call(this,
c,d);return this.settingsDAO.getSecret(function(b){return i.setItem("public","sharedstuff-"+b,JSON.stringify(c),a)})};return b}(f);(function(){function a(c){this.key=c}a.prototype.readAllItems=function(){return JSON.parse(localStorage.getItem(this.key)||"[]")};a.prototype.findItemByID=function(a,c){return _.find(a,function(a){return a.id===c})};a.prototype.list=function(a){return a(this.readAllItems())};a.prototype.getItem=function(a,c){return c(_.find(this.readAllItems(),function(c){return c.id===
a}))};a.prototype.save=function(a){utils.cleanObjectFromAngular(a);return localStorage.setItem(this.key,JSON.stringify(a))};a.prototype.saveItem=function(a){var c,b;c=this.readAllItems();b=this.findItemByID(c,a.id);c[_.indexOf(c,b)]=a;return this.save(c)};a.prototype.deleteItem=function(a){var c;c=this.readAllItems();a=this.findItemByID(c,a);return this.save(_.without(c,a))};return a})();d=function(){function a(){this.settings=null;this.key="settings"}a.prototype.readSettings=function(a){var b;b=
this;return b.settings?c(function(){return a(b.settings)}):i.getItem("sharedstuff",b.key,function(c,d){var e;e=JSON.parse(d||"{}");b.settings=e;if(e.secret)return a(e);e.secret=k(20);return i.setItem("sharedstuff",b.key,JSON.stringify(e),function(){return a(e)})})};a.prototype.getSecret=function(a){return this.readSettings(function(c){return a(c.secret)})};return a}();b=function(){function a(c){this.friendDAO=c;this.friendsStuffList=[]}a.prototype.listStuffByFriend=function(a,c){if(a.userAddress)return remoteStorage.getStorageInfo(a.userAddress,
function(b,d){var e;e=remoteStorage.createClient(d,"public");return d?e.get("sharedstuff-"+a.secret,function(a,b){return b?c(JSON.parse(b||"[]")):c([])}):h(b)})};a.prototype.validateFriend=function(a,c){return utils.isBlank(a.userAddress)?c(["userAddress"]):remoteStorage.getStorageInfo(a.userAddress,function(b,d){var e;if(d)return e=remoteStorage.createClient(d,"public"),e.get("sharedstuff-"+a.secret,function(a,b){if(b)return c([]);h(a);return c(["secret"])});h(b);return c(["userAddress"])})};a.prototype.list=
function(a){var c;c=this;return this.friendDAO.list(function(b){var d,e,f,h,k;k=[];f=0;for(h=b.length;f<h;f++)e=b[f],d=function(b){return function(d){c._updateWithLoadedItems(b,d);return a(c.friendsStuffList)}},k.push(c.listStuffByFriend(e,d(e)));return k})};a.prototype._updateWithLoadedItems=function(a,c){var b,d,e,f,h;h=[];e=0;for(f=c.length;e<f;e++)d=c[e],d.owner=a,(b=_.find(this.friendsStuffList,function(a){return a.id===d.id}))?h.push(this.friendsStuffList[_.indexOf(this.friendsStuffList,b)]=
d):h.push(this.friendsStuffList.push(d));return h};return a}();f=new f("sharedstuff","myFriendsList");d=new d;angular.module("myApp.services",[]).value("version","0.1").value("settingsDAO",d).value("stuffDAO",new e("sharedstuff","myStuffList",d)).value("friendDAO",f).value("friendsStuffDAO",new b(f))}).call(this);(function(){var b;b=function(b,f){b.logout=function(){remoteStorageUtils.deleteToken();return f.path("/login")};b.setLoggenOn=function(){b.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!0};return b.$digest()};return remoteStorageUtils.isLoggedOn(function(d){if(d)return b.setLoggenOn();b.session={userAddress:null,isLoggedIn:!1};0<window.location.href.indexOf("#login")?sessionStorage.setItem("targetHref",window.location.href):sessionStorage.setItem("targetHref","#");return window.location.replace("#login")})};
b.$inject=["$scope","$location","settingsDAO"];this.AppController=b}).call(this);(function(){var b,e,f,d,c;d=utils.focus;c=utils.focusAndSelect;e=function(a,b,e,i,g){var j;a.friendList=[];a.isAddFriendFormHidden=!0;a.isInviteFriendFormHidden=!0;j=a.session;a.inviteUrl="Loading...";b.list(function(c){a.friendList=c;a.isAddFriendFormHidden=0<a.friendList.length;g.userAddress&&(a.friend=new Friend({userAddress:g.userAddress,secret:g.secret}),a.isAddFriendFormHidden=!1);return a.$digest()});a.showAddForm=function(){a.isAddFriendFormHidden=!1;a.isInviteFriendFormHidden=!0;return d("name")};
a.friend=new Friend;a.addFriend=function(){a.friend.sanitize();return e.validateFriend(a.friend,function(c){if(0===c.length)return a.friendList.push(new Friend(a.friend)),b.save(a.friendList),a.friend=new Friend,a.isAddFriendFormHidden=!0,a.$digest(),d("showAddFriendFormButton");a.showValidationErrors=!0;return window.alert(c.join(",")+" seems invalid")})};a.inviteFriend=function(){a.isInviteFriendFormHidden=!1;a.isAddFriendFormHidden=!0;return i.getSecret(function(b){a.inviteUrl=f(j.userAddress,
b);a.$digest();return c("inviteUrl")})};a.closeInviteFriend=function(){return a.isInviteFriendFormHidden=!0};return d("showAddFriendFormButton")};f=function(a,c){var b;b=window.location;return b.protocol+"//"+b.host+b.pathname+"#"+("/addFriend/"+a+"/"+c)};e.$inject=["$scope","friendDAO","friendsStuffDAO","settingsDAO","$routeParams"];b=function(a,c,b,d,e){var f;a.friend=new Friend;a.editMode=!1;a.stuffList=[];a.showValidationErrors=!0;c.getItem(d.id,function(c){a.friend=new Friend(c);a.$digest();
return b.listStuffByFriend(c,function(c){a.stuffList=c;return a.$digest()})});f=function(){return a.$apply(function(){return e.path("/friends")})};a.save=function(){a.friend.sanitize();return b.validateFriend(a.friend,function(b){return 0===b.length?c.saveItem(a.friend,f):window.alert(b.join(",")+" seems invalid")})};a.showEditMode=function(){return a.editMode=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete your friend "'+a.friend.name+'"?'))return c.deleteItem(a.friend.id,
f)}};b.$inject=["$scope","friendDAO","friendsStuffDAO","$routeParams","$location"];this.FriendsController=e;this.FriendEditController=b}).call(this);(function(){var b,e,f,d;f=utils.focus;d=function(c){return!utils.isBlank(c.title)};b=function(c,a){c.stuffList=[];c.isAddStuffFormHidden=!0;a.list(function(a){c.stuffList=a;c.isAddStuffFormHidden=0<c.stuffList.length;return c.$digest()});c.showAddForm=function(){c.isAddStuffFormHidden=!1;return f("title")};c.stuff=new Stuff;c.addStuff=function(){return d(c.stuff)?(c.stuffList.push(new Stuff(c.stuff)),a.save(c.stuffList,function(){}),c.stuff=new Stuff,c.isAddStuffFormHidden=!0,f("showAddStuffFormButton")):
c.showValidationErrors=!0};return f("showAddStuffFormButton")};b.$inject=["$scope","stuffDAO"];e=function(c,a,b,e){var f;c.stuff=new Stuff;a.getItem(b.id,function(a){c.stuff=new Stuff(a);return c.$digest()});f=function(){return c.$apply(function(){return e.path("/mystuff")})};c.save=function(){return d(c.stuff)?(c.stuff.modify(),a.saveItem(c.stuff,f)):c.showValidationErrors=!0};return c["delete"]=function(){if(window.confirm('Do you really want to delete this stuff called "'+c.stuff.title+'"?'))return a.deleteItem(c.stuff.id,
f)}};e.$inject=["$scope","stuffDAO","$routeParams","$location"];this.MyStuffController=b;this.MyStuffEditController=e}).call(this);(function(){var b,e;e=utils.log;b=function(b,d,c,a){b.stuffList=[];b.sortAttribute="-modified";b.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};d(function(){return a.list(function(a){b.stuffList=a;return b.$digest()})});return b.sortBy=function(a){e(a);return b.sortAttribute=a}};b.$inject=["$scope","$defer","friendDAO","friendsStuffDAO"];this.FriendsStuffController=b}).call(this);var log=utils.log;function AboutController(b){utils.log(b.session);b.bla="blase";log(utils.randomString(10))}AboutController.$inject=["$scope"];angular.module("myApp.directives",[]).directive("appVersion",["version",function(b){return function(e,f){f.text(b)}}]).directive("appSelectOnFocus",[function(){return function(b,e){e.bind("focus",function(){e.select()})}}]);angular.module("myApp.filters",[]).filter("interpolate",["version",function(b){return function(e){return(""+e).replace(/\%VERSION\%/mg,b)}}]);(function(){var b,e,f,d;d=utils.focus;b=function(c,a){c.secret="Loading secret ...";return a.getSecret(function(a){c.secret=a;return c.$digest()})};b.$inject=["$scope","settingsDAO"];e=function(c,a,b){return c["export"]=function(){return b.list(function(b){return a.list(function(a){utils.cleanObjectFromAngular(b);utils.cleanObjectFromAngular(a);c.exportedData=JSON.stringify({stuff:b,friends:a});c.$digest();return d("exportTextarea")})})}};e.$inject=["$scope","friendDAO","stuffDAO"];f=function(b,a,
d){b.importDataText="";return b.startImport=function(){var e,f,g;e=JSON.parse(b.importDataText);g=0;f=function(){g--;if(0===g)return window.alert("Import Done!"),b.importDataText=""};null!=e&&e.stuff&&(g++,d.save(e.stuff,f));if(null!=e&&e.friends)return g++,a.save(e.friends,f)}};f.$inject=["$scope","friendDAO","stuffDAO"];this.AccountController=b;this.ExportController=e;this.ImportController=f}).call(this);(function(){var b,e,f;e=utils.log;f=remoteStorageUtils;b=function(b){e("Login");b.session.isLoggedIn=!1;b.userAddress="shybyte@owncube.com";return b.login=function(){var c;try{return c=b.userAddress,e("userAddress:"+c),c?f.connect(c,function(){return f.authorize(["public","sharedstuff"],function(){var a;localStorage.setItem("userAddress",c);a=sessionStorage.getItem("targetHref")||"index.html";sessionStorage.removeItem("targetHref");window.location.replace(a);return b.setLoggenOn()})}):alert("Please enter a remote storage id!")}catch(a){return e(a)}}};
b.$inject=["$scope","settingsDAO"];this.LoginController=b}).call(this);angular.module("myApp",["myApp.filters","myApp.services","myApp.directives"]).config(["$routeProvider",function(b){b.when("/login",{template:"partials/login.html",controller:LoginController});b.when("/mystuff",{template:"partials/my-stuff.html",controller:MyStuffController});b.when("/mystuff/:id",{template:"partials/my-stuff-edit.html",controller:MyStuffEditController});b.when("/friends",{template:"partials/friends.html",controller:FriendsController});b.when("/friends/:id",{template:"partials/friend-edit.html",
controller:FriendEditController});b.when("/addFriend/:userAddress/:secret",{template:"partials/friends.html",controller:FriendsController});b.when("/friends-stuff",{template:"partials/friends-stuff.html",controller:FriendsStuffController});b.when("/account",{template:"partials/account.html",controller:AccountController});b.when("/export",{template:"partials/account-export.html",controller:ExportController});b.when("/import",{template:"partials/account-import.html",controller:ImportController});b.when("/settings",
{template:"partials/account-settings.html",controller:AccountController});b.when("/about",{template:"partials/about.html",controller:AboutController});b.otherwise({redirectTo:"/friends-stuff"})}]);angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])});
