(function(){var b,d,g,e,h,c,a,i=Object.prototype.hasOwnProperty;b=function(a,b){var c,f;f=[];for(c=a;a<=b?c<=b:c>=b;a<=b?c++:c--)f.push(String.fromCharCode(c));return f};c=function(){var b;b=[];for(a=0;9>=a;a++)b.push(""+a);return b}().concat(b(65,90)).concat(b(97,122));h=function(a){return a[Math.floor(Math.random()*a.length)]};g=function(a){return!a||/^\s*$/.test(a)};d=function(a){var b,c,f;c="";for(b in a)f=a[b],"string"===typeof f?c+=" "+f.toLowerCase():"object"===typeof f&&(c+=" "+d(f));return c};
e=function(a,b){var c;c=d(a);return _.all(b,function(a){return 0<=c.indexOf(a)})};this.utils={log:function(a){return console.log(a)},focus:function(a){return setTimeout(function(){return $("#"+a).focus()},100)},cleanObjectFromAngular:function(a){var b,c,f,e,d;d=[];f=0;for(e=a.length;f<e;f++)b=a[f],d.push(function(){var a;a=[];for(c in b)i.call(b,c)&&(0<=c.indexOf("$$")?a.push(delete b[c]):a.push(void 0));return a}());return d},randomString:function(a){var b,e;e=[];for(b=0;0<=a?b<=a:b>=a;0<=a?b++:
b--)e.push(h(c));return e.join("")},doNothing:function(){},defer:function(a){return setTimeout(function(){return a()},1)},isBlank:g,focusAndSelect:function(a){return setTimeout(function(){return $("#"+a).focus().select()},100)},applyIfNeeded:function(a,b){return a.$root.$$phase?b():a.$apply(b)},search:function(a,b){var c;if(g(b))return a;c=b.toLowerCase().split(/\s+/g);return _.filter(a,function(a){return e(a,c)})}}}).call(this);var remoteStorageUtils=function(){function b(a,f,b,c){"timeout"==a?window.confirm("We got an timeout! Shoud I try again?")?f.apply(this,b):c&&c():401==a&&window.alert("Looks like your session has expired! Please log out and log back in.")}function d(){return location.href.substring(0,location.href.length-location.hash.length).replace(/\/[^\/]*$/,"")+"/remote-storage-login-popup.html"}function g(c,f,m){var h=arguments;a=m;var j=d();i=window.open(j);e(c,function(a,c){if(c){var e=remoteStorage.createOAuthAddress(c,
f,j);i.location.replace(e)}else i.close();b(a,g,h)})}function e(a,f){remoteStorage.getStorageInfo(a,function(a,b){a?(alert("Could not load storage info"),console.log(a)):(console.log("Storage info received:"),console.log(b),localStorage.setItem(j,JSON.stringify(b)));f(a,b)})}function h(a,f,c){var e=arguments,d=JSON.parse(localStorage.getItem(j));if("public"==a)d=remoteStorage.createClient(d,"public");else var g=localStorage.getItem(k),d=remoteStorage.createClient(d,a,g);d.get(f,function(d,g){d?(console.log(d),
b(d,h,e,function(){c(d,g)})):(void 0==g?console.log("There wasn't anything for \""+f+'" in category "'+a+'"'):console.log('We received this for key "'+f+'" in category "'+a+'": '+g),c(void 0,g))})}function c(a,f,c,e){var d=arguments,g=JSON.parse(localStorage.getItem(j)),i=localStorage.getItem(k);remoteStorage.createClient(g,a,i).put(f,c,function(g){g?(console.log('Could not store "'+f+'" in "'+a+'" category'),console.log(g),b(g,h,d,function(){e&&e(g)})):(console.log('Stored "'+c+'" for key "'+f+'" in "'+
a+'" category'),e&&e())})}var a,i,k="remoteStorageToken",j="userStorageInfo";window.addEventListener("message",function(b){b.origin==location.protocol+"//"+location.host&&(console.log("Received an OAuth token: "+b.data),localStorage.setItem(k,b.data),a(b.data))},!1);return{connect:e,authorize:function(b,f){a=f;var c=JSON.parse(localStorage.getItem(j)),e=d();console.log("RedirectUrl: "+e);c=remoteStorage.createOAuthAddress(c,b,e);window.open(c)},connectAndAuthorize:g,getItem:h,setItem:c,isLoggedOn:function(a){(!localStorage.getItem(j)||
!localStorage.getItem(k))&&setTimeout(function(){a(!1)},10);try{c("sharedstuff","loggedOnTest","test",function(b){a(!b)})}catch(b){a(!1)}},deleteToken:function(){localStorage.removeItem(k)}}}();(function(){var b;b={rent:"Rent",gift:"Gift","use-together":"Use Together"};this.Localizer=function(){function d(){}d.prototype.sharingType=function(d){return b[d]||d};return d}()}).call(this);(function(){var b,d,g,e,h;h=utils.isBlank;e=function(b,a){var e,d,g;g=[];for(e in b)d=b[e],e in a?g.push(void 0):g.push(a[e]=d);return g};g=function(){function b(a){var c;null==a&&(a={});this.title=a.title||"";this.description=a.description||"";this.visibility=a.visibility||"friends";this.sharingTypes=a.sharingTypes||["rent"];this.sharingDirection=a.sharingDirection||"give";this.categories=a.categories||"";this.link=a.link||"";this.image=a.image||"";c=(new Date).getTime();this.id=a.id||""+c;this.created=
a.created||c;this.modified=a.modified||this.created;e(a,this)}b.prototype.modify=function(){return this.modified=(new Date).getTime()};b.prototype.getLocation=function(){var a;return this.location||(null!=(a=this.owner)?a.location:void 0)||""};b.sharingTypeValues=["rent","gift","use-together"];b.sharingDirectionValues=["give","wish"];return b}();b=function(){function b(a){null==a&&(a={});this.id=a.id||""+(new Date).getTime();this.name=a.name||a.userAddress||"";this.userAddress=a.userAddress||"";this.secret=
a.secret||"";e(a,this)}b.prototype.sanitize=function(){if(utils.isBlank(this.name))return this.name=this.userAddress};return b}();d=function(){function b(a){null==a&&(a={});this.name=a.name||"";this.email=a.email||"";this.image=a.image||"";this.location=a.location||"";e(a,this)}b.isEmpty=function(){return h(this.name)&&h(this.email)&&h(this.image)};return b}();this.Stuff=g;this.Friend=b;this.Profile=d}).call(this);(function(){var b,d,g,e,h,c,a,i,k,j,l,f,m,o,n,p,q=Object.prototype.hasOwnProperty,r=function(a,b){function f(){this.constructor=a}for(var c in b)q.call(b,c)&&(a[c]=b[c]);f.prototype=b.prototype;a.prototype=new f;a.__super__=b.prototype;return a};m=utils.log;f=utils.isBlank;k=utils.doNothing;o=utils.randomString;i=utils.defer;g="sharedstuff-profile";n=remoteStorageUtils;p=function(a){return a};c=function(){function a(b,f,c,e){this.remoteStorageUtils=b;this.category=f;this.key=c;this.wrapItem=null!=
e?e:p}a.prototype.readAllItems=function(a){var b;b=this;return b.dataCache?i(function(){return a(b.dataCache.items)}):b.remoteStorageUtils.getItem(this.category,this.key,function(f,c){b.dataCache=JSON.parse(c||"{}");b.dataCache.items=l(b.dataCache,b.wrapItem);return a(b.dataCache.items)})};a.prototype.findItemByID=function(a,b){return _.find(a,function(a){return a.id===b})};a.prototype.list=function(a){return this.readAllItems(a)};a.prototype.getItem=function(a,b){return this.getItemBy("id",a,b)};
a.prototype.getItemBy=function(a,b,f){return this.readAllItems(function(c){return f(_.find(c,function(f){return f[a]===b}))})};a.prototype.save=function(a,b){utils.cleanObjectFromAngular(a);this.dataCache||(this.dataCache={});this.dataCache.items=a;return this.remoteStorageUtils.setItem(this.category,this.key,JSON.stringify(this.dataCache),b)};a.prototype.saveItem=function(a,b){var f;f=this;return this.readAllItems(function(c){var e;(e=f.findItemByID(c,a.id))?c[_.indexOf(c,e)]=a:c.push(a);return f.save(c,
b)})};a.prototype.deleteItem=function(a,b){var f;f=this;return this.readAllItems(function(c){var e;e=f.findItemByID(c,a);return f.save(_.without(c,e),b)})};return a}();d=function(a){function b(a,f,c,e){this.remoteStorageUtils=a;this.category=f;this.key=c;this.settingsDAO=e;b.__super__.constructor.call(this,this.remoteStorageUtils,this.category,this.key,function(a){return new Stuff(a)})}r(b,a);b.prototype.save=function(a,f){var c,e;e=this;b.__super__.save.call(this,a,f);this.settingsDAO.getSecret(function(b){return e.remoteStorageUtils.setItem("public",
"sharedstuff-"+b,JSON.stringify({items:a}),k)});c=_.filter(a,function(a){return"public"===a.visibility});return e.remoteStorageUtils.setItem("public","sharedstuff-public",JSON.stringify({items:c}),k)};return b}(c);(function(){function a(b){this.key=b}a.prototype.readAllItems=function(){return JSON.parse(localStorage.getItem(this.key)||"[]")};a.prototype.findItemByID=function(a,b){return _.find(a,function(a){return a.id===b})};a.prototype.list=function(a){return a(this.readAllItems())};a.prototype.getItem=
function(a,b){return b(_.find(this.readAllItems(),function(b){return b.id===a}))};a.prototype.save=function(a){utils.cleanObjectFromAngular(a);return localStorage.setItem(this.key,JSON.stringify(a))};a.prototype.saveItem=function(a){var b,f;b=this.readAllItems();f=this.findItemByID(b,a.id);b[_.indexOf(b,f)]=a;return this.save(b)};a.prototype.deleteItem=function(a){var b;b=this.readAllItems();a=this.findItemByID(b,a);return this.save(_.without(b,a))};return a})();a=function(){function a(){this.settings=
null;this.key="settings"}a.prototype.readSettings=function(a){var b;b=this;return b.settings?i(function(){return a(b.settings)}):n.getItem("sharedstuff",b.key,function(f,c){var e;if("timeout"!==f){e=JSON.parse(c||"{}");b.settings=e;if(e.secret)return a(e);e.secret=o(20);return b.saveSettings(a)}})};a.prototype.getSecret=function(a){return this.readSettings(function(b){return a(b.secret)})};a.prototype.saveSettings=function(a){var b;b=this;return n.setItem("sharedstuff",b.key,JSON.stringify(b.settings),
function(){return a(b.settings)})};return a}();e=function(){function a(b){this.publicRemoteStorageService=b;this.profile=null;this.key=g}a.prototype.load=function(a){var b;b=this;return b.profile?i(function(){return a(b.profile)}):n.getItem("public",b.key,function(f,c){b.profile=JSON.parse(c||"{}");return a(new Profile(b.profile))})};a.prototype.save=function(a,b){var f;f=this;f.profile=a;return n.setItem("public",f.key,JSON.stringify(f.profile),function(){return b(f.profile)})};a.prototype.getByFriend=
function(a,b){return this.publicRemoteStorageService.get(a.userAddress,this.key,{},function(a){return b(new Profile(a))})};return a}();h=function(){function a(){this.clientByUserAddress={}}a.prototype.get=function(a,b,f,c){var e;e=this;if(a)return this.clientByUserAddress[a]?this.getByClient(this.clientByUserAddress[a],b,f,c):remoteStorage.getStorageInfo(a,function(d,g){var h;if(g)return h=remoteStorage.createClient(g,"public"),e.clientByUserAddress[a]=h,e.getByClient(h,b,f,c);m(d);return c(f,d)});
m("Missing UserAdress!");return c(f)};a.prototype.getByClient=function(a,b,f,c){return a.get(b,function(a,b){return b?c(JSON.parse(b)):c(f)})};return a}();l=function(a,b){return _.map((null!=a?a.items:void 0)||[],b)};b=function(){function a(b,f,c){this.friendDAO=b;this.publicRemoteStorageDAO=f;this.profileDAO=c;this.friendsStuffList=[]}a.prototype.listStuffByFriend=function(a,b){var f;f=this;return this.profileDAO.getByFriend(a,function(c){a.location=c.location;return f.publicRemoteStorageDAO.get(a.userAddress,
j(a),[],function(f){return b(l(f,function(b){b=new Stuff(b);b.owner=a;return b}))})})};a.prototype.validateFriend=function(a,b){return utils.isBlank(a.userAddress)?b(["userAddress"]):remoteStorage.getStorageInfo(a.userAddress,function(c,e){var d;if(e)return d=remoteStorage.createClient(e,"public"),f(a.secret)?b([]):d.get(j(a),function(a,f){if(f)return b([]);m(a);return b(["secret"])});m(c);return b(["userAddress"])})};a.prototype.clearCache=function(){return this.friendsStuffList=[]};a.prototype.list=
function(a){var b;b=this;return this.friendDAO.list(function(f){var c,e,d,g,h;e=0;0===f.length&&a(b.friendsStuffList,"NO_FRIENDS");h=[];d=0;for(g=f.length;d<g;d++)c=f[d],h.push(b.listStuffByFriend(c,function(c){b._updateWithLoadedItems(c);e++;return a(b.friendsStuffList,e===f.length?"LOADED":"LOADING")}));return h})};a.prototype._updateWithLoadedItems=function(a){var b,f,c,e,d;d=[];c=0;for(e=a.length;c<e;c++)f=a[c],(b=_.find(this.friendsStuffList,function(a){return a.id===f.id}))?d.push(this.friendsStuffList[_.indexOf(this.friendsStuffList,
b)]=f):d.push(this.friendsStuffList.push(f));return d};return a}();j=function(a){return"sharedstuff-"+(!f(a.secret)?a.secret:"public")};(function(){var f,g,i,j;f=new c(remoteStorageUtils,"sharedstuff","myFriendsList",function(a){return new Friend(a)});j=new a;i=new h;g=new e(i);return angular.module("myApp.services",[]).value("version","0.1").value("settingsDAO",j).value("stuffDAO",new d(remoteStorageUtils,"sharedstuff","myStuffList",j)).value("friendDAO",f).value("friendsStuffDAO",new b(f,i,g)).value("profileDAO",
g).value("localizer",new Localizer)})();this.RemoteStorageDAO=c;this.MyStuffDAO=d}).call(this);(function(){var b,d,g,e,h;g=utils.log;d=utils.applyIfNeeded;h=function(b){return/^\/[^@\/]+@.+/.test(b)};e=function(b){return!(_.any(["invitation","login"],function(a){return 1===b.indexOf(a)})||h(b))};b=function(b,a){var h;b.isAppLoaded=!1;b.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!1};b.logout=function(){remoteStorageUtils.deleteToken();localStorage.removeItem("userAddress");b.session={userAddress:null,isLoggedIn:!1};return window.location.href="logout.html"};b.setLoggenOn=
function(){b.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!0};b.isAppLoaded=!0;return b.$digest()};h=function(){var h;h=a.path();g(h);if(!b.session.isLoggedIn&&e(a.path()))return sessionStorage.setItem("targetPath",h),d(b,function(){return a.path("/login").replace()});if("/login"===h&&b.session.isLoggedIn)return d(b,function(){return a.path("/friends-stuff").replace()})};if(b.session.userAddress)return remoteStorageUtils.isLoggedOn(function(a){a?b.setLoggenOn():(b.session={userAddress:null,
isLoggedIn:!1},d(b,function(){return b.isAppLoaded=!0}));h();return b.$on("$routeChangeStart",h)});b.$on("$routeChangeStart",h);return b.isAppLoaded=!0};b.needsUserLoggedIn=e;b.$inject=["$scope","$location"];this.AppController=b}).call(this);(function(){var b,d,g,e,h,c,a,i,k,j,l;i=utils.focus;k=utils.focusAndSelect;j=utils.isBlank;h=utils.applyIfNeeded;g=function(a,b,c,e,d){a.friendList=[];a.isAddFriendFormHidden=!0;a.isInviteFriendButtonShown=!0;a.friend=new Friend;b.list(function(b){a.friendList=b;a.isAddFriendFormHidden=0<a.friendList.length;d.userAddress&&(a.friend=new Friend({name:d.name,userAddress:d.userAddress,secret:d.secret}),a.isAddFriendFormHidden=!1);a.status="LOADED";return a.$digest()});a.showAddForm=function(){a.isAddFriendFormHidden=
!1;a.isInviteFriendButtonShown=!1;return i("name")};a.closeForm=function(){a.isAddFriendFormHidden=!0;return a.isInviteFriendButtonShown=!0};a.addFriend=function(){a.friend.sanitize();return c.validateFriend(a.friend,function(c){if(0===c.length)return a.friendList.push(new Friend(a.friend)),b.save(a.friendList),a.friend=new Friend,a.closeForm(),a.$digest(),i("showAddFriendFormButton");a.showValidationErrors=!0;return l(a.friend,c)})};a.inviteFriend=function(){return e.path("/share-stuff")};a.$watch("friend.userAddress",
function(c){return j(c)?a.existingFriend=void 0:b.getItemBy("userAddress",c,function(b){return h(a,function(){return a.existingFriend=b})})});return i("showAddFriendFormButton")};c=function(b,c){return a(b)+"/"+c};a=function(a){var b;b=window.location;return b.protocol+"//"+b.host+b.pathname+"#"+a};g.$inject=["$scope","friendDAO","friendsStuffDAO","$location","$routeParams"];b=function(a,b,c,e,d,g){var h,j;a.friend=new Friend;a.editMode=!1;a.stuffList=[];a.profile={};a.showValidationErrors=!0;a.status=
"LOADING";h=function(){return b.getItem(d.id,function(b){a.friend=new Friend(b);a.$digest();c.listStuffByFriend(b,function(b){a.stuffList=b;a.status="LOADED";return a.$digest()});return e.getByFriend(b,function(b){a.profile=new Profile(b);return a.$digest()})})};h();j=function(){return a.$apply(function(){return g.path("/friends")})};a.save=function(){a.friend.sanitize();return c.validateFriend(a.friend,function(c){return 0===c.length?b.saveItem(a.friend,function(){a.editMode=!1;return h()}):l(a.friend,
c)})};a.showEditMode=function(){return a.editMode=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete your friend "'+a.friend.name+'"?'))return b.deleteItem(a.friend.id,j)}};b.$inject="$scope,friendDAO,friendsStuffDAO,profileDAO,$routeParams,$location".split(",");l=function(a,b){var c;c=b.join(",")+" seems invalid.";_.include(b,"secret")&&(c=j(a.secret)?c+" This could mean that your friend has not added public shared stuff yet.":c+" This could mean that your friend has not added secret shared stuff yet.");
return window.alert(c)};d=function(a,b,c,e,d,g){var h;a.stuffList=[];h=new Friend({userAddress:d.user+"@"+d.host,secret:d.secret});a.friend=h;a.existingFriend=void 0;a.profile={};a.status="LOADING";c.listStuffByFriend(h,function(b){a.stuffList=b;a.status="LOADED";return a.$digest()});a.session.isLoggedIn&&b.getItemBy("userAddress",h.userAddress,function(b){return a.existingFriend=b});e.getByFriend(h,function(b){a.profile=new Profile(b);h.name=b.name?b.name:h.userAddress.replace(/@.*$/,"")||"unkown";
return a.$digest()});return a.addFriend=function(){return g.path("/addFriend/"+h.name+"/"+h.userAddress+"/"+h.secret)}};d.$inject="$scope,friendDAO,friendsStuffDAO,profileDAO,$routeParams,$location".split(",");e=function(b,e,d){return d.list(function(d){if(0<d.length)return e.getSecret(function(e){var d;d=b.session.userAddress;b.inviteUrl=c(d,e);b.publicInviteUrl=a(d);b.$digest();return k("inviteUrl")});b.showNoStuffWarning=!0;return b.$digest()})};e.$inject=["$scope","settingsDAO","stuffDAO"];this.FriendsController=
g;this.FriendEditController=b;this.FriendViewController=d;this.ShareStuffController=e}).call(this);(function(){var b,d,g,e,h,c;c=utils.log;e=utils.focus;h=function(a){return!utils.isBlank(a.title)};g={friends:"Friends (Secret)","public":"Public"};b=function(a,b,c){a.stuffList=[];a.isAddStuffFormHidden=!0;a.circles=g;a.sortAttribute=sessionStorage.getItem("my-stuff-sortAttribute")||"-modified";a.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};a.sharingDirections=Stuff.sharingDirectionValues;c.load(function(b){a.profile=b;return a.$digest()});b.list(function(b){a.stuffList=
b;a.isAddStuffFormHidden=0<a.stuffList.length;a.status="LOADED";return a.$digest()});a.showAddForm=function(){a.isAddStuffFormHidden=!1;return e("title")};a.closeForm=function(){return a.isAddStuffFormHidden=!0};a.sortBy=function(b){sessionStorage.setItem("my-stuff-sortAttribute",b);return a.sortAttribute=b};a.stuff=new Stuff({visibility:sessionStorage.getItem("new-stuff-visibility")||null});a.addStuff=function(){return h(a.stuff)?(sessionStorage.setItem("new-stuff-visibility",a.stuff.visibility),
a.stuffList.push(new Stuff(a.stuff)),b.save(a.stuffList,function(){}),a.stuff=new Stuff({visibility:a.stuff.visibility}),a.isAddStuffFormHidden=!0,e("showAddStuffFormButton")):a.showValidationErrors=!0};return e("showAddStuffFormButton")};b.$inject=["$scope","stuffDAO","profileDAO"];d=function(a,b,e,d,l){var f;a.stuff=new Stuff;a.circles=g;a.sharingDirections=Stuff.sharingDirectionValues;e.load(function(b){a.profile=b;return a.$digest()});b.getItem(d.id,function(b){c(b);a.stuff=new Stuff(b);c(a.stuff);
return a.$digest()});f=function(){return a.$apply(function(){return l.path("/mystuff")})};a.save=function(){return h(a.stuff)?(c(a.stuff),a.stuff.modify(),b.saveItem(a.stuff,f)):a.showValidationErrors=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete this stuff called "'+a.stuff.title+'"?'))return b.deleteItem(a.stuff.id,f)}};d.$inject=["$scope","stuffDAO","profileDAO","$routeParams","$location"];this.MyStuffController=b;this.MyStuffEditController=d}).call(this);(function(){var b,d,g;g=utils.log;d=function(b,d){var c;if("giveAndWish"===d)c=b;else{var a,g,k;k=[];a=0;for(g=b.length;a<g;a++)c=b[a],c.sharingDirection===d&&k.push(c);c=k}return c};b=function(b,h,c,a){var i,k;b.stuffList=[];b.filteredStuffList=[];b.sortAttribute=sessionStorage.getItem("friends-stuff-sortAttribute")||"-modified";b.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};b.sharingDirection=sessionStorage.getItem("friends-stuff-sharingDirection")||"giveAndWish";
b.sharingDirectionNames={giveAndWish:"Give & Wish",give:"Give",wish:"Wish"};b.status="LOADING";i=function(){var a;a=d(b.stuffList,b.sharingDirection);return b.filteredStuffList=utils.search(a,b.searchQuery)};k=function(){return a.list(function(a,c){b.stuffList=a;"LOADED"!==b.status&&(b.status=c);i();return b.$digest()})};h(function(){a.clearCache();return k()});b.sortBy=function(a){sessionStorage.setItem("friends-stuff-sortAttribute",a);return b.sortAttribute=a};b.setSharingDirection=function(a){sessionStorage.setItem("friends-stuff-sharingDirection",
a);return b.sharingDirection=a};b.$watch("searchQuery",i);b.$watch("sharingDirection",i);return b.$on("$destroy",function(){return g("destroyed FriendsStuffController")})};b.$inject=["$scope","$timeout","friendDAO","friendsStuffDAO"];this.FriendsStuffController=b}).call(this);var log=utils.log;function AboutController(b){log("About");log(b.session);b.bla="blase";log(utils.randomString(10));b.msValues=[{id:"rent"},{id:"gift"},{id:"use-together"},{id:"sell"}]}AboutController.$inject=["$scope"];(function(){angular.module("myApp.directives",[]).directive("appVersion",["version",function(b){return function(d,g){return g.text(b)}}]).directive("appSelectOnFocus",[function(){return function(b,d){return d.bind("focus",function(){return setTimeout(function(){return d.select()},100)})}}]).directive("stuffImage",[function(){return function(b,d,g){d.addClass("stuffImageBox");return b.$watch(g.src,function(){var b,h;h=g.src;if(utils.isBlank(h))return d.hide();b=new Image;b.src=h;b.className="stuffImage";
return d.append(b)})}}]).directive("multiSelect",[function(){return{scope:{options:"=",values:"=",localizationType:"@"},template:'<div class="multiSelect">\n  <span ng-repeat="option in options">\n    <label class="checkBoxLabel">\n      <input type="checkbox" ng-model="selected[option]"> {{option | localize:localizationType}}\n    </label>\n  </span>\n</div>',link:function(b){b.$watch("values",function(){var d,g,e,h,c;b.selected={};h=b.values;c=[];g=0;for(e=h.length;g<e;g++)d=h[g],c.push(b.selected[d]=
!0);return c});return b.$watch("selected",function(){var d,g,e,h;e=b.selected;h=[];for(g in e)(d=e[g])&&h.push(g);return b.values=h},!0)}}}]).directive("sharingTypesSelect",[function(){return{scope:{values:"="},template:'<div multi-select options="options" values="values" localization-type="sharingType"/>',link:function(b){return b.options=Stuff.sharingTypeValues}}}]).directive("sharingTypes",[function(){return{scope:{values:"="},template:'<span ng-show="values.length">for {{values | sharingTypes}}</span>'}}]).directive("myStuff",
[function(){return{scope:{item:"=",profile:"="},template:'<h3><a href="#/mystuff/{{item.id}}">{{item.title || "Untitled"}}</a><span class="wish" ng-show="item.sharingDirection==\'wish\'"> [Wish]</span></h3>\n<span stuff-image src="{{item.image}}"/>\n<p class="description" ng-bind-html="item.description | urlize"></p>\n<p class="stuffFooter">\n    <span ng-show="item.visibility == \'public\'" class="owner visibility">Public</span>\n    {{item.categories}}\n    <span ng-show="item.location">in {{item.getLocation()}}</span>\n    <span ng-show="!item.location && profile.location">in your profile location {{profile.location}}</span>\n    <span sharing-types values="item.sharingTypes" />\n    <a ng-show="item.link" href="{{item.link}}" target="link">External Link</a>\n</p>'}}]).directive("friendStuff",
[function(){return{scope:{item:"="},template:'<h3>{{item.title || "Untitled"}}<span class="wish" ng-show="item.sharingDirection==\'wish\'"> [Wish]</span></h3>\n  <span stuff-image src="{{item.image}}"/>\n  <p class="description" ng-bind-html="item.description | urlize"></p>\n  <p class="stuffFooter">\n      {{item.categories}}\n      <span class="owner" ng-show="item.owner">from <a href="#/friends/{{item.owner.id}}">{{item.owner.name}}</a></span> ({{ item.modified | date}})\n      <span ng-show="item.getLocation()">in {{item.getLocation()}}</span>\n      <span sharing-types values="item.sharingTypes" />\n      <a ng-show="item.link" href="{{item.link}}" target="link">External Link</a>\n  </p>'}}])}).call(this);(function(){angular.module("myApp.filters",[]).filter("interpolate",["version",function(b){return function(d){return(""+d).replace(/\%VERSION\%/mg,b)}}]).filter("urlize",function(){return function(b){return urlize(b,{target:"link"})}}).filter("sharingTypes",["localizer",function(b){return function(d){var g;if(d){var e,h,c;c=[];e=0;for(h=d.length;e<h;e++)g=d[e],c.push(b.sharingType(g));d=c.join(", ")}else d="";return d}}]).filter("localize",["localizer",function(b){return function(d,g){return b[g]?
b[g](d)||d:d}}])}).call(this);(function(){var b,d,g,e,h,c;c=utils.log;h=utils.focus;e=function(a,b){c(["Loading Profile"]);b.load(function(b){a.profile=new Profile(b);c(["Loaded Profile",b]);return a.$digest()});return a.save=function(){return b.save(a.profile,function(){$("#savedAlert").addClass("in").removeClass("out");return setTimeout(function(){return $("#savedAlert").addClass("out").removeClass("in")},5E3)})}};e.$inject=["$scope","profileDAO"];b=function(a,b){a.secret="Loading secret ...";return b.getSecret(function(b){a.secret=
b;return a.$digest()})};b.$inject=["$scope","settingsDAO"];d=function(a,b,c){return a["export"]=function(){return c.list(function(c){return b.list(function(b){utils.cleanObjectFromAngular(c);utils.cleanObjectFromAngular(b);a.exportedData=JSON.stringify({stuff:c,friends:b});a.$digest();return h("exportTextarea")})})}};d.$inject=["$scope","friendDAO","stuffDAO"];g=function(a,b,c){a.importDataText="";return a.startImport=function(){var d,e,f;d=JSON.parse(a.importDataText);f=0;e=function(){f--;if(0===
f)return window.alert("Import Done!"),a.importDataText=""};null!=d&&d.stuff&&(f++,c.save(d.stuff,e));if(null!=d&&d.friends)return f++,b.save(d.friends,e)}};g.$inject=["$scope","friendDAO","stuffDAO"];this.AccountController=b;this.ExportController=d;this.ImportController=g;this.ProfileController=e}).call(this);(function(){var b,d,g;d=utils.log;g=remoteStorageUtils;b=function(b,h){return b.login=function(){var c;try{return c=b.userAddress,d("userAddress:"+c),c?g.connectAndAuthorize(c,["public","sharedstuff"],function(){var a;localStorage.setItem("userAddress",c);b.setLoggenOn();a=sessionStorage.getItem("targetPath")||"/";sessionStorage.removeItem("targetPath");return b.$apply(function(){return h.path(a).replace()})}):alert("Please enter a remote storage id!")}catch(a){return d(a)}}};b.$inject=["$scope",
"$location"];this.LoginController=b}).call(this);angular.module("myApp",["ngSanitize","myApp.filters","myApp.services","myApp.directives"]).config(["$routeProvider",function(b){b.when("/login",{templateUrl:"partials/login.html",controller:LoginController});b.when("/mystuff",{templateUrl:"partials/my-stuff.html",controller:MyStuffController});b.when("/mystuff/:id",{templateUrl:"partials/my-stuff-edit.html",controller:MyStuffEditController});b.when("/share-stuff",{templateUrl:"partials/share-stuff.html",controller:ShareStuffController});b.when("/friends",
{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/friends/:id",{templateUrl:"partials/friend-edit.html",controller:FriendEditController});b.when("/addFriend/:name/:userAddress/:secret",{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/addFriend/:name/:userAddress",{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/invitation/:user@:host/:secret",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/:user@:host/:secret",
{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/invitation/:user@:host",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/:user@:host",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/friends-stuff",{templateUrl:"partials/friends-stuff.html",controller:FriendsStuffController});b.when("/account",{templateUrl:"partials/profile.html",controller:ProfileController});b.when("/profile",{templateUrl:"partials/profile.html",
controller:ProfileController});b.when("/export",{templateUrl:"partials/account-export.html",controller:ExportController});b.when("/import",{templateUrl:"partials/account-import.html",controller:ImportController});b.when("/settings",{templateUrl:"partials/account-settings.html",controller:AccountController});b.when("/about",{templateUrl:"partials/about.html",controller:AboutController});b.otherwise({redirectTo:"/friends-stuff"})}]);
angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])});
