(function(){var b,d,g,e,h,c,a,i,j=Object.prototype.hasOwnProperty;b=function(a,b){var c,f;f=[];for(c=a;a<=b?c<=b:c>=b;a<=b?c++:c--)f.push(String.fromCharCode(c));return f};a=function(){var a;a=[];for(i=0;9>=i;i++)a.push(""+i);return a}().concat(b(65,90)).concat(b(97,122));c=function(a){return a[Math.floor(Math.random()*a.length)]};e=function(a){return!a||/^\s*$/.test(a)};d=function(a){var b,c,f;c="";for(b in a)f=a[b],"string"===typeof f?c+=" "+f.toLowerCase():"object"===typeof f&&(c+=" "+d(f));return c};
h=function(a,b){var c;c=d(a);return _.all(b,function(a){return 0<=c.indexOf(a)})};g=function(){return(new Date).getTime()};this.utils={log:function(a){return console.log(a)},focus:function(a){return setTimeout(function(){return $("#"+a).focus()},100)},cleanObjectFromAngular:function(a){var b,c,f,e,d;d=[];f=0;for(e=a.length;f<e;f++)b=a[f],d.push(function(){var a;a=[];for(c in b)j.call(b,c)&&(0<=c.indexOf("$$")?a.push(delete b[c]):a.push(void 0));return a}());return d},randomString:function(b){var e,
d;d=[];for(e=0;0<=b?e<=b:e>=b;0<=b?e++:e--)d.push(c(a));return d.join("")},doNothing:function(){},defer:function(a){return setTimeout(function(){return a()},1)},isBlank:e,focusAndSelect:function(a){return setTimeout(function(){return $("#"+a).focus().select()},100)},applyIfNeeded:function(a,b){return a.$root.$$phase?b():a.$apply(b)},search:function(a,b){var c;if(e(b))return a;c=b.toLowerCase().split(/\s+/g);return _.filter(a,function(a){return h(a,c)})},getCurrentTime:g,isOlderThan:function(a,b){return g()-
a>b},digestIfNeeded:function(a){if(!a.$$phase)return a.$digest()}}}).call(this);var remoteStorageUtils=function(){function b(a,b,f,c){if("timeout"==a)window.confirm("We got an timeout! Shoud I try again?")?b.apply(this,f):c&&c();else if(401==a||403==a)window.alert("Looks like your session has expired! We have to log out you. Please log back in."),AppController.logout()}function d(){return location.href.substring(0,location.href.length-location.hash.length).replace(/\/[^\/]*$/,"")+"/remote-storage-login-popup.html"}function g(c,h,f){var j=arguments;a=f;var k=d();i=window.open(k);
e(c,function(a,f){if(f){var c=remoteStorage.createOAuthAddress(f,h,k);i.location.replace(c)}else i.close();b(a,g,j)})}function e(a,b){remoteStorage.getStorageInfo(a,function(a,c){a?(alert("Could not load storage info"),console.log(a)):(console.log("Storage info received:"),console.log(c),localStorage.setItem(k,JSON.stringify(c)));b(a,c)})}function h(a,c,f){var e=arguments,d=JSON.parse(localStorage.getItem(k));if("public"==a)d=remoteStorage.createClient(d,"public");else var i=localStorage.getItem(j),
d=remoteStorage.createClient(d,a,i);d.get(c,function(d,i){d?(console.log(d),b(d,h,e,function(){f(d,i)})):(void 0==i?console.log("There wasn't anything for \""+c+'" in category "'+a+'"'):console.log('We received this for key "'+c+'" in category "'+a+'": '+i),f(void 0,i))})}function c(a,e,f,d){var i=arguments,g=JSON.parse(localStorage.getItem(k)),h=localStorage.getItem(j);remoteStorage.createClient(g,a,h).put(e,f,function(g){g?(console.log('Could not store "'+e+'" in "'+a+'" category'),console.log(g),
b(g,c,i,function(){d&&d(g)})):(console.log('Stored "'+f+'" for key "'+e+'" in "'+a+'" category'),d&&d())})}var a,i,j="remoteStorageToken",k="userStorageInfo";window.addEventListener("message",function(c){c.origin==location.protocol+"//"+location.host&&(console.log("Received an OAuth token: "+c.data),localStorage.setItem(j,c.data),a(c.data))},!1);return{connect:e,authorize:function(c,b){a=b;var f=JSON.parse(localStorage.getItem(k)),e=d();console.log("RedirectUrl: "+e);f=remoteStorage.createOAuthAddress(f,
c,e);window.open(f)},connectAndAuthorize:g,getItem:h,setItem:c,isLoggedOn:function(a){(!localStorage.getItem(k)||!localStorage.getItem(j))&&setTimeout(function(){a(!1)},10);try{c("sharedstuff","loggedOnTest","test",function(f){a(!f)})}catch(b){a(!1)}},deleteToken:function(){localStorage.removeItem(j)}}}();(function(){var b;b={rent:"Rent",gift:"Gift","use-together":"Use Together"};this.Localizer=function(){function d(){}d.prototype.sharingType=function(d){return b[d]||d};return d}()}).call(this);(function(){var b,d,g,e,h;h=utils.isBlank;e=function(c,a){var b,e,d;d=[];for(b in c)e=c[b],b in a?d.push(void 0):d.push(a[b]=e);return d};g=function(){function b(a){var c;null==a&&(a={});this.title=a.title||"";this.description=a.description||"";this.visibility=a.visibility||"friends";this.sharingTypes=a.sharingTypes||["rent"];this.sharingDirection=a.sharingDirection||"give";this.categories=a.categories||"";this.link=a.link||"";this.image=a.image||"";c=(new Date).getTime();this.id=a.id||""+c;this.created=
a.created||c;this.modified=a.modified||this.created;e(a,this)}b.prototype.modify=function(){return this.modified=(new Date).getTime()};b.prototype.getLocation=function(){var a;return this.location||(null!=(a=this.owner)?a.location:void 0)||""};b.sharingTypeValues=["rent","gift","use-together"];b.sharingDirectionValues=["give","wish"];return b}();b=function(){function b(a){null==a&&(a={});this.id=a.id||""+(new Date).getTime();this.name=a.name||a.userAddress||"";this.userAddress=a.userAddress||"";this.secret=
a.secret||"";e(a,this)}b.prototype.sanitize=function(){if(utils.isBlank(this.name))return this.name=this.userAddress};return b}();d=function(){function b(a){null==a&&(a={});this.name=a.name||"";this.email=a.email||"";this.image=a.image||"";this.location=a.location||"";e(a,this)}b.isEmpty=function(){return h(this.name)&&h(this.email)&&h(this.image)};return b}();this.Stuff=g;this.Friend=b;this.Profile=d}).call(this);(function(){var b,d,g,e,h,c,a,i,j,k,m,l,f,p,r,n,s,q,t,o=function(a,b){return function(){return a.apply(b,arguments)}},u=Object.prototype.hasOwnProperty,v=function(a,b){function f(){this.constructor=a}for(var c in b)u.call(b,c)&&(a[c]=b[c]);f.prototype=b.prototype;a.prototype=new f;a.__super__=b.prototype;return a};n=utils.log;p=utils.isBlank;k=utils.doNothing;s=utils.randomString;j=utils.defer;m=utils.getCurrentTime;r=utils.isOlderThan;e="sharedstuff-profile";q=remoteStorageUtils;t=function(a){return a};
a=function(){function a(b,f,c,e){this.remoteStorageUtils=b;this.category=f;this.key=c;this.wrapItem=null!=e?e:t;this.deleteItem=o(this.deleteItem,this);this.saveItem=o(this.saveItem,this);this.readAllItems=o(this.readAllItems,this)}a.prototype.readAllItems=function(a){var b=this;return this.dataCache?j(function(){return a(b.dataCache.items)}):this.remoteStorageUtils.getItem(this.category,this.key,function(c,e){b.dataCache=JSON.parse(e||"{}");b.dataCache.items=f(b.dataCache,b.wrapItem);return a(b.dataCache.items)})};
a.prototype.findItemByID=function(a,b){return _.find(a,function(a){return a.id===b})};a.prototype.list=function(a){return this.readAllItems(a)};a.prototype.getItem=function(a,b){return this.getItemBy("id",a,b)};a.prototype.getItemBy=function(a,b,f){return this.readAllItems(function(c){return f(_.find(c,function(f){return f[a]===b}))})};a.prototype.save=function(a,b){utils.cleanObjectFromAngular(a);this.dataCache||(this.dataCache={});this.dataCache.items=a;return this.remoteStorageUtils.setItem(this.category,
this.key,JSON.stringify(this.dataCache),b)};a.prototype.saveItem=function(a,b){var f=this;return this.readAllItems(function(c){var e;(e=f.findItemByID(c,a.id))?c[_.indexOf(c,e)]=a:c.push(a);return f.save(c,b)})};a.prototype.deleteItem=function(a,b){var f=this;return this.readAllItems(function(c){var e;e=f.findItemByID(c,a);return f.save(_.without(c,e),b)})};return a}();g=function(a){function b(a,f,c,e){this.remoteStorageUtils=a;this.category=f;this.key=c;this.settingsDAO=e;b.__super__.constructor.call(this,
this.remoteStorageUtils,this.category,this.key,function(a){return new Stuff(a)})}v(b,a);b.prototype.save=function(a,f){var c,e=this;b.__super__.save.call(this,a,f);this.settingsDAO.getSecret(function(b){return e.remoteStorageUtils.setItem("public","sharedstuff-"+b,JSON.stringify({items:a}),k)});c=_.filter(a,function(a){return"public"===a.visibility});return this.remoteStorageUtils.setItem("public","sharedstuff-public",JSON.stringify({items:c}),k)};return b}(a);(function(){function a(b){this.key=b}
a.prototype.readAllItems=function(){return JSON.parse(localStorage.getItem(this.key)||"[]")};a.prototype.findItemByID=function(a,b){return _.find(a,function(a){return a.id===b})};a.prototype.list=function(a){return a(this.readAllItems())};a.prototype.getItem=function(a,b){return b(_.find(this.readAllItems(),function(b){return b.id===a}))};a.prototype.save=function(a){utils.cleanObjectFromAngular(a);return localStorage.setItem(this.key,JSON.stringify(a))};a.prototype.saveItem=function(a){var b,f;b=
this.readAllItems();f=this.findItemByID(b,a.id);b[_.indexOf(b,f)]=a;return this.save(b)};a.prototype.deleteItem=function(a){var b;b=this.readAllItems();a=this.findItemByID(b,a);return this.save(_.without(b,a))};return a})();i=function(){function a(){this.saveSettings=o(this.saveSettings,this);this.readSettings=o(this.readSettings,this);this.settings=null;this.key="settings"}a.prototype.readSettings=function(a){var b=this;return this.settings?j(function(){return a(b.settings)}):q.getItem("sharedstuff",
this.key,function(f,c){var e;if("timeout"!==f){e=JSON.parse(c||"{}");b.settings=e;if(e.secret)return a(e);e.secret=s(20);return b.saveSettings(a)}})};a.prototype.getSecret=function(a){return this.readSettings(function(b){return a(b.secret)})};a.prototype.saveSettings=function(a){var b=this;return q.setItem("sharedstuff",this.key,JSON.stringify(this.settings),function(){return a(b.settings)})};return a}();h=function(){function a(b,f){this.publicRemoteStorageService=b;this.getTime=null!=f?f:m;this.getByFriendWithDeferedRefresh=
o(this.getByFriendWithDeferedRefresh,this);this.save=o(this.save,this);this.load=o(this.load,this);this.profile=null;this.key=e}a.prototype.load=function(a){var b=this;return this.profile?j(function(){return a(b.profile)}):q.getItem("public",this.key,function(f,c){b.profile=JSON.parse(c||"{}");return a(new Profile(b.profile))})};a.prototype.save=function(a,b){var f=this;this.profile=a;return q.setItem("public",this.key,JSON.stringify(this.profile),function(){return b(f.profile)})};a.prototype.getByFriend=
function(a,b){return this._getByFriend("get",a,b)};a.prototype.getByFriendRefreshed=function(a,b){return this._getByFriend("getRefreshed",a,b)};a.prototype.getByFriendWithDeferedRefresh=function(a,b,f){var c=this;return this.getByFriend(a,function(e,d){f(e,d);if(c.getTime()-d.cacheTime>b)return n("Update Profile defered"),c.getByFriendRefreshed(a,f)})};a.prototype._getByFriend=function(a,b,f){return this.publicRemoteStorageService[a](b.userAddress,this.key,{},function(a,b){return f(new Profile(a),
b)})};return a}();b=function(){return function(a,b){this.time=a;this.data=b}}();c=function(){function a(b,f,c){this.remoteStorage=b;this.localStorage=f;this.getTime=null!=c?c:m;this.getByClient=o(this.getByClient,this);this._refresh=o(this._refresh,this);this.clientByUserAddress={}}a.prototype.get=function(a,b,f,c){var e;if(a)return(e=this.localStorage.getItem(this.localStorageKey(a,b)))?(n("Loading "+a+":"+b+" from cache"),a=JSON.parse(e),c(a.data||f,{cacheTime:a.time})):this._refresh(a,b,f,c);n("Missing UserAdress!");
c(f,{error:"Missing UserAddress",cacheTime:this.getTime()})};a.prototype.getRefreshed=function(a,b,f,c){if(a)return this._refresh(a,b,f,c);n("Missing UserAdress!");return c(f,{error:"Missing UserAddress",cacheTime:this.getTime()})};a.prototype._refresh=function(a,b,f,c){var e=this;return this.clientByUserAddress[a]?this.getByClient(a,this.clientByUserAddress[a],b,f,c):this.remoteStorage.getStorageInfo(a,function(d,g){var i;if(g)return i=e.remoteStorage.createClient(g,"public"),e.clientByUserAddress[a]=
i,e.getByClient(a,i,b,f,c);n(d);return c(f,{error:d,cacheTime:e.getTime()})})};a.prototype.getByClient=function(a,f,c,e,d){var g=this;return f.get(c,function(f,i){var h,j,k;h=g.getTime();k={cacheTime:h};j=i?JSON.parse(i):null;g.cacheInLocalStorage(a,c,new b(h,j));return d(j||e,k)})};a.prototype.cacheInLocalStorage=function(a,b,f){return this.localStorage.setItem(this.localStorageKey(a,b),JSON.stringify(f))};a.prototype.localStorageKey=function(a,b){return"remoteStorageCache:"+a+":public:"+b};return a}();
f=function(a,b){return _.map((null!=a?a.items:void 0)||[],b)};d=function(){function a(b,f,c){this.friendDAO=b;this.publicRemoteStorageDAO=f;this.profileDAO=c;this.listStuffByFriend=o(this.listStuffByFriend,this);this.friendsStuffList=[];this.cacheTimeByFriendID={};this.friends=[]}a.prototype.listStuffByFriend=function(a,b,c){var e=this;null==c&&(c=!1);return this.profileDAO[c?"getByFriendRefreshed":"getByFriend"](a,function(d,g){a.location=d.location;return e.publicRemoteStorageDAO[c?"getRefreshed":
"get"](a.userAddress,l(a),[],function(c,e){n("Got Stuff for "+a.name);return b(f(c,function(b){b=new Stuff(b);b.owner=a;return b}),{cacheTime:Math.min(g.cacheTime,e.cacheTime)})})})};a.prototype.listStuffByFriendRefreshed=function(a,b){return this.listStuffByFriend(a,b,!0)};a.prototype.listStuffByFriendWithDeferedRefresh=function(a,b,f){var c=this;return this.listStuffByFriend(a,function(e,d){f(e,d);if(r(d.cacheTime,b))return n("Update friend's stuff defered"),c.listStuffByFriendRefreshed(a,f)})};
a.prototype.refreshMostOutdatedFriend=function(a,b){var f,c=this;f=_.min(this.friends,function(a){return c.cacheTimeByFriendID[a.id]||0});if(r(this.cacheTimeByFriendID[f.id],a))return this.listStuffByFriend(f,function(a,e){n("Updating "+f.name);c._updateWithLoadedItems(a);c.cacheTimeByFriendID[f.id]=e;return b(c.friends,c.friendsStuffList,"LOADED")},!0)};a.prototype.validateFriend=function(a,b){return utils.isBlank(a.userAddress)?b(["userAddress"]):remoteStorage.getStorageInfo(a.userAddress,function(f,
c){var e;if(c)return e=remoteStorage.createClient(c,"public"),p(a.secret)?b([]):e.get(l(a),function(a,f){if(f)return b([]);n(a);return b(["secret"])});n(f);return b(["userAddress"])})};a.prototype.clearCache=function(){return this.friendsStuffList=[]};a.prototype.list=function(a){var b=this;return this.friendDAO.list(function(f){var c,e,d,g,i;b.friends=f;e=0;0===f.length&&a(b.friends,b.friendsStuffList,"NO_FRIENDS");i=[];d=0;for(g=f.length;d<g;d++)c=f[d],i.push(b.listStuffByFriend(c,function(d,g){b._updateWithLoadedItems(d);
b.cacheTimeByFriendID[c.id]=g.cacheTime;e++;return a(b.friends,b.friendsStuffList,e===f.length?"LOADED":"LOADING")}));return i})};a.prototype._updateWithLoadedItems=function(a){var b,f,c,e,d;d=[];c=0;for(e=a.length;c<e;c++)f=a[c],(b=_.find(this.friendsStuffList,function(a){return a.id===f.id}))?d.push(this.friendsStuffList[_.indexOf(this.friendsStuffList,b)]=f):d.push(this.friendsStuffList.push(f));return d};return a}();l=function(a){return"sharedstuff-"+(!p(a.secret)?a.secret:"public")};(function(){var b,
f,e,j;b=new a(remoteStorageUtils,"sharedstuff","myFriendsList",function(a){return new Friend(a)});j=new i;e=new c(remoteStorage,localStorage);f=new h(e);return angular.module("myApp.services",[]).value("version","0.1").value("settingsDAO",j).value("stuffDAO",new g(remoteStorageUtils,"sharedstuff","myStuffList",j)).value("friendDAO",b).value("friendsStuffDAO",new d(b,e,f)).value("profileDAO",f).value("localizer",new Localizer)})();this.RemoteStorageDAO=a;this.MyStuffDAO=g;this.ProfileDAO=h;this.PublicRemoteStorageService=
c;this.FriendsStuffDAO=d;this.RS_CATEGORY="sharedstuff"}).call(this);(function(){var b,d,g,e,h;g=utils.log;d=utils.applyIfNeeded;h=function(b){return/^\/[^@\/]+@.+/.test(b)};e=function(b){return!(_.any(["invitation","login"],function(a){return 1===b.indexOf(a)})||h(b))};b=function(c,a){var i;c.isAppLoaded=!1;c.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!1};c.logout=function(){c.session={userAddress:null,isLoggedIn:!1};return b.logout()};c.setLoggenOn=function(){c.session={userAddress:localStorage.getItem("userAddress"),isLoggedIn:!0};c.isAppLoaded=
!0;return c.$digest()};i=function(){var b;b=a.path();g(b);if(!c.session.isLoggedIn&&e(a.path()))return sessionStorage.setItem("targetPath",b),d(c,function(){return a.path("/login").replace()});if("/login"===b&&c.session.isLoggedIn)return d(c,function(){return a.path("/friends-stuff").replace()})};if(c.session.userAddress)return remoteStorageUtils.isLoggedOn(function(a){a?c.setLoggenOn():(c.session={userAddress:null,isLoggedIn:!1},d(c,function(){return c.isAppLoaded=!0}));i();return c.$on("$routeChangeStart",
i)});c.$on("$routeChangeStart",i);return c.isAppLoaded=!0};b.needsUserLoggedIn=e;b.logout=function(){remoteStorageUtils.deleteToken();localStorage.removeItem("userAddress");return window.location.href="logout.html"};b.$inject=["$scope","$location"];this.AppController=b}).call(this);(function(){var b,d,g,e,h,c,a,i,j,k,m,l;j=utils.focus;k=utils.focusAndSelect;m=utils.isBlank;h=utils.applyIfNeeded;i=utils.digestIfNeeded;g=function(a,b,c,e,d){a.friendList=[];a.isAddFriendFormHidden=!0;a.isInviteFriendButtonShown=!0;a.friend=new Friend;b.list(function(b){a.friendList=b;a.isAddFriendFormHidden=0<a.friendList.length;d.userAddress&&(a.friend=new Friend({name:d.name,userAddress:d.userAddress,secret:d.secret}),a.isAddFriendFormHidden=!1);a.status="LOADED";return a.$digest()});a.showAddForm=
function(){a.isAddFriendFormHidden=!1;a.isInviteFriendButtonShown=!1;return j("name")};a.closeForm=function(){a.isAddFriendFormHidden=!0;return a.isInviteFriendButtonShown=!0};a.addFriend=function(){a.friend.sanitize();return c.validateFriend(a.friend,function(c){if(0===c.length)return a.friendList.push(new Friend(a.friend)),b.save(a.friendList),a.friend=new Friend,a.closeForm(),a.$digest(),j("showAddFriendFormButton");a.showValidationErrors=!0;return l(a.friend,c)})};a.inviteFriend=function(){return e.path("/share-stuff")};
a.$watch("friend.userAddress",function(c){return m(c)?a.existingFriend=void 0:b.getItemBy("userAddress",c,function(b){return h(a,function(){return a.existingFriend=b})})});return j("showAddFriendFormButton")};c=function(b,c){return a(b)+"/"+c};a=function(a){var b;b=window.location;return b.protocol+"//"+b.host+b.pathname+"#"+a};g.$inject=["$scope","friendDAO","friendsStuffDAO","$location","$routeParams"];b=function(a,b,c,e,d,g){var h,j;a.friend=new Friend;a.editMode=!1;a.stuffList=[];a.profile={};
a.showValidationErrors=!0;a.status="LOADING";h=function(){return b.getItem(d.id,function(b){a.friend=new Friend(b);i(a);c.listStuffByFriendWithDeferedRefresh(b,1E4,function(b){a.stuffList=b;a.status="LOADED";return i(a)});return e.getByFriendWithDeferedRefresh(b,1E4,function(b){a.profile=new Profile(b);return i(a)})})};h();j=function(){return a.$apply(function(){return g.path("/friends")})};a.save=function(){a.friend.sanitize();return c.validateFriend(a.friend,function(c){return 0===c.length?b.saveItem(a.friend,
function(){a.editMode=!1;return h()}):l(a.friend,c)})};a.showEditMode=function(){return a.editMode=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete your friend "'+a.friend.name+'"?'))return b.deleteItem(a.friend.id,j)}};b.$inject="$scope,friendDAO,friendsStuffDAO,profileDAO,$routeParams,$location".split(",");l=function(a,b){var c;c=b.join(",")+" seems invalid.";_.include(b,"secret")&&(c=m(a.secret)?c+" This could mean that your friend has not added public shared stuff yet.":
c+" This could mean that your friend has not added secret shared stuff yet.");return window.alert(c)};d=function(a,b,c,e,d,g){var h;a.stuffList=[];h=new Friend({userAddress:d.user+"@"+d.host,secret:d.secret});a.friend=h;a.existingFriend=void 0;a.profile={};a.status="LOADING";c.listStuffByFriendWithDeferedRefresh(h,1E4,function(b){a.stuffList=b;a.status="LOADED";return i(a)});a.session.isLoggedIn&&b.getItemBy("userAddress",h.userAddress,function(b){return a.existingFriend=b});e.getByFriendWithDeferedRefresh(h,
1E4,function(b){a.profile=new Profile(b);h.name=b.name?b.name:h.userAddress.replace(/@.*$/,"")||"unkown";return i(a)});return a.addFriend=function(){return g.path("/addFriend/"+h.name+"/"+h.userAddress+"/"+h.secret)}};d.$inject="$scope,friendDAO,friendsStuffDAO,profileDAO,$routeParams,$location".split(",");e=function(b,e,d){return d.list(function(d){if(0<d.length)return e.getSecret(function(e){var d;d=b.session.userAddress;b.inviteUrl=c(d,e);b.publicInviteUrl=a(d);b.$digest();return k("inviteUrl")});
b.showNoStuffWarning=!0;return b.$digest()})};e.$inject=["$scope","settingsDAO","stuffDAO"];this.FriendsController=g;this.FriendEditController=b;this.FriendViewController=d;this.ShareStuffController=e}).call(this);(function(){var b,d,g,e,h,c;c=utils.log;e=utils.focus;h=function(a){return!utils.isBlank(a.title)};g={friends:"Friends (Secret)","public":"Public"};b=function(a,b,c){a.stuffList=[];a.isAddStuffFormHidden=!0;a.circles=g;a.sortAttribute=sessionStorage.getItem("my-stuff-sortAttribute")||"-modified";a.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};a.sharingDirections=Stuff.sharingDirectionValues;c.load(function(b){a.profile=b;return a.$digest()});b.list(function(b){a.stuffList=
b;a.isAddStuffFormHidden=0<a.stuffList.length;a.status="LOADED";return a.$digest()});a.showAddForm=function(){a.isAddStuffFormHidden=!1;return e("title")};a.closeForm=function(){return a.isAddStuffFormHidden=!0};a.sortBy=function(b){sessionStorage.setItem("my-stuff-sortAttribute",b);return a.sortAttribute=b};a.stuff=new Stuff({visibility:sessionStorage.getItem("new-stuff-visibility")||null});a.addStuff=function(){return h(a.stuff)?(sessionStorage.setItem("new-stuff-visibility",a.stuff.visibility),
a.stuffList.push(new Stuff(a.stuff)),b.save(a.stuffList,function(){}),a.stuff=new Stuff({visibility:a.stuff.visibility}),a.isAddStuffFormHidden=!0,e("showAddStuffFormButton")):a.showValidationErrors=!0};return e("showAddStuffFormButton")};b.$inject=["$scope","stuffDAO","profileDAO"];d=function(a,b,e,d,m){var l;a.stuff=new Stuff;a.circles=g;a.sharingDirections=Stuff.sharingDirectionValues;e.load(function(b){a.profile=b;return a.$digest()});b.getItem(d.id,function(b){c(b);a.stuff=new Stuff(b);c(a.stuff);
return a.$digest()});l=function(){return a.$apply(function(){return m.path("/mystuff")})};a.save=function(){return h(a.stuff)?(c(a.stuff),a.stuff.modify(),b.saveItem(a.stuff,l)):a.showValidationErrors=!0};return a["delete"]=function(){if(window.confirm('Do you really want to delete this stuff called "'+a.stuff.title+'"?'))return b.deleteItem(a.stuff.id,l)}};d.$inject=["$scope","stuffDAO","profileDAO","$routeParams","$location"];this.MyStuffController=b;this.MyStuffEditController=d}).call(this);(function(){var b,d,g;g=utils.log;d=function(b,d){var c;if("giveAndWish"===d)c=b;else{var a,g,j;j=[];a=0;for(g=b.length;a<g;a++)c=b[a],c.sharingDirection===d&&j.push(c);c=j}return c};b=function(b,h,c,a){var i,j,k,m,l,f,p;b.stuffList=[];b.filteredStuffList=[];b.sortAttribute=sessionStorage.getItem("friends-stuff-sortAttribute")||"-modified";b.sortAttributeNames={"-modified":"Newest",title:"Title","owner.name":"Friend"};b.sharingDirection=sessionStorage.getItem("friends-stuff-sharingDirection")||"giveAndWish";
b.sharingDirectionNames={giveAndWish:"Give & Wish",give:"Give",wish:"Wish"};b.status="LOADING";j=b.showLoadingIndicator=!1;p=void 0;l=0;i=function(){var a;a=d(b.stuffList,b.sharingDirection);return b.filteredStuffList=utils.search(a,b.searchQuery)};m=function(){l-=1;return a.refreshMostOutdatedFriend(6E4,k)};f=function(){return b.showLoadingIndicator="LOADING"===b.status&&j};k=function(a,c,d){b.stuffList=c;"LOADED"!==b.status&&(b.status=d,"LOADED"===d&&(l=a.length));i();f();b.$digest();if("LOADED"===
d&&0<l)return p=setTimeout(m,250)};b.sortBy=function(a){sessionStorage.setItem("friends-stuff-sortAttribute",a);return b.sortAttribute=a};b.setSharingDirection=function(a){sessionStorage.setItem("friends-stuff-sharingDirection",a);return b.sharingDirection=a};b.$watch("searchQuery",i);b.$watch("sharingDirection",i);b.$on("$destroy",function(){g("FriendsStuffController is destroyed");if(p)return clearTimeout(p),l=0,g("Stopped Refresh")});a.clearCache();a.list(k);return h(function(){j=!0;return f()},
500)};b.$inject=["$scope","$timeout","friendDAO","friendsStuffDAO"];this.FriendsStuffController=b}).call(this);var log=utils.log;function AboutController(b){log("About");log(b.session);b.bla="blase";log(utils.randomString(10));b.msValues=[{id:"rent"},{id:"gift"},{id:"use-together"},{id:"sell"}]}AboutController.$inject=["$scope"];(function(){angular.module("myApp.directives",[]).directive("appVersion",["version",function(b){return function(d,g){return g.text(b)}}]).directive("appSelectOnFocus",[function(){return function(b,d){return d.bind("focus",function(){return setTimeout(function(){return d.select()},100)})}}]).directive("stuffImage",[function(){return function(b,d,g){d.addClass("stuffImageBox");return b.$watch(g.src,function(){var b,h;h=g.src;if(utils.isBlank(h))return d.hide();b=new Image;b.src=h;b.className="stuffImage";
return d.append(b)})}}]).directive("multiSelect",[function(){return{scope:{options:"=",values:"=",localizationType:"@"},template:'<div class="multiSelect">\n  <span ng-repeat="option in options">\n    <label class="checkBoxLabel">\n      <input type="checkbox" ng-model="selected[option]"> {{option | localize:localizationType}}\n    </label>\n  </span>\n</div>',link:function(b){b.$watch("values",function(){var d,g,e,h,c;b.selected={};h=b.values;c=[];g=0;for(e=h.length;g<e;g++)d=h[g],c.push(b.selected[d]=
!0);return c});return b.$watch("selected",function(){var d,g,e,h;e=b.selected;h=[];for(g in e)(d=e[g])&&h.push(g);return b.values=h},!0)}}}]).directive("sharingTypesSelect",[function(){return{scope:{values:"="},template:'<div multi-select options="options" values="values" localization-type="sharingType"/>',link:function(b){return b.options=Stuff.sharingTypeValues}}}]).directive("sharingTypes",[function(){return{scope:{values:"="},template:'<span ng-show="values.length">for {{values | sharingTypes}}</span>'}}]).directive("myStuff",
[function(){return{scope:{item:"=",profile:"="},template:'<h3><a href="#/mystuff/{{item.id}}">{{item.title || "Untitled"}}</a><span class="wish" ng-show="item.sharingDirection==\'wish\'"> [Wish]</span></h3>\n<span stuff-image src="{{item.image}}"/>\n<p class="description" ng-bind-html="item.description | urlize"></p>\n<p class="stuffFooter">\n    <span ng-show="item.visibility == \'public\'" class="owner visibility">Public</span>\n    {{item.categories}}\n    <span ng-show="item.location">in {{item.getLocation()}}</span>\n    <span ng-show="!item.location && profile.location">in your profile location {{profile.location}}</span>\n    <span sharing-types values="item.sharingTypes" />\n    <a ng-show="item.link" href="{{item.link}}" target="link">External Link</a>\n</p>'}}]).directive("friendStuff",
[function(){return{scope:{item:"="},template:'<h3>{{item.title || "Untitled"}}<span class="wish" ng-show="item.sharingDirection==\'wish\'"> [Wish]</span></h3>\n  <span stuff-image src="{{item.image}}"/>\n  <p class="description" ng-bind-html="item.description | urlize"></p>\n  <p class="stuffFooter">\n      {{item.categories}}\n      <span class="owner" ng-show="item.owner">from <a href="#/friends/{{item.owner.id}}">{{item.owner.name}}</a></span> ({{ item.modified | date}})\n      <span ng-show="item.getLocation()">in {{item.getLocation()}}</span>\n      <span sharing-types values="item.sharingTypes" />\n      <a ng-show="item.link" href="{{item.link}}" target="link">External Link</a>\n  </p>'}}])}).call(this);(function(){angular.module("myApp.filters",[]).filter("interpolate",["version",function(b){return function(d){return(""+d).replace(/\%VERSION\%/mg,b)}}]).filter("urlize",function(){return function(b){return urlize(b,{target:"link"})}}).filter("sharingTypes",["localizer",function(b){return function(d){var g;if(d){var e,h,c;c=[];e=0;for(h=d.length;e<h;e++)g=d[e],c.push(b.sharingType(g));d=c.join(", ")}else d="";return d}}]).filter("localize",["localizer",function(b){return function(d,g){return b[g]?
b[g](d)||d:d}}])}).call(this);(function(){var b,d,g,e,h,c;c=utils.log;h=utils.focus;e=function(a,b){c(["Loading Profile"]);b.load(function(b){a.profile=new Profile(b);c(["Loaded Profile",b]);return a.$digest()});return a.save=function(){return b.save(a.profile,function(){$("#savedAlert").addClass("in").removeClass("out");return setTimeout(function(){return $("#savedAlert").addClass("out").removeClass("in")},5E3)})}};e.$inject=["$scope","profileDAO"];b=function(a,b){a.secret="Loading secret ...";return b.getSecret(function(b){a.secret=
b;return a.$digest()})};b.$inject=["$scope","settingsDAO"];d=function(a,b,c){return a["export"]=function(){return c.list(function(c){return b.list(function(b){utils.cleanObjectFromAngular(c);utils.cleanObjectFromAngular(b);a.exportedData=JSON.stringify({stuff:c,friends:b});a.$digest();return h("exportTextarea")})})}};d.$inject=["$scope","friendDAO","stuffDAO"];g=function(a,b,c){a.importDataText="";return a.startImport=function(){var d,e,g;d=JSON.parse(a.importDataText);g=0;e=function(){g--;if(0===
g)return window.alert("Import Done!"),a.importDataText=""};null!=d&&d.stuff&&(g++,c.save(d.stuff,e));if(null!=d&&d.friends)return g++,b.save(d.friends,e)}};g.$inject=["$scope","friendDAO","stuffDAO"];this.AccountController=b;this.ExportController=d;this.ImportController=g;this.ProfileController=e}).call(this);(function(){var b,d,g;d=utils.log;g=remoteStorageUtils;b=function(b,h){return b.login=function(){var c;try{return c=b.userAddress,d("userAddress:"+c),c?g.connectAndAuthorize(c,["public","sharedstuff"],function(){var a;localStorage.setItem("userAddress",c);b.setLoggenOn();a=sessionStorage.getItem("targetPath")||"/";sessionStorage.removeItem("targetPath");return b.$apply(function(){return h.path(a).replace()})}):alert("Please enter a remote storage id!")}catch(a){return d(a)}}};b.$inject=["$scope",
"$location"];this.LoginController=b}).call(this);angular.module("myApp",["ngSanitize","myApp.filters","myApp.services","myApp.directives"]).config(["$routeProvider",function(b){b.when("/login",{templateUrl:"partials/login.html",controller:LoginController});b.when("/mystuff",{templateUrl:"partials/my-stuff.html",controller:MyStuffController});b.when("/mystuff/:id",{templateUrl:"partials/my-stuff-edit.html",controller:MyStuffEditController});b.when("/share-stuff",{templateUrl:"partials/share-stuff.html",controller:ShareStuffController});b.when("/friends",
{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/friends/:id",{templateUrl:"partials/friend-edit.html",controller:FriendEditController});b.when("/addFriend/:name/:userAddress/:secret",{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/addFriend/:name/:userAddress",{templateUrl:"partials/friends.html",controller:FriendsController});b.when("/invitation/:user@:host/:secret",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/:user@:host/:secret",
{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/invitation/:user@:host",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/:user@:host",{templateUrl:"partials/friend.html",controller:FriendViewController});b.when("/friends-stuff",{templateUrl:"partials/friends-stuff.html",controller:FriendsStuffController});b.when("/account",{templateUrl:"partials/profile.html",controller:ProfileController});b.when("/profile",{templateUrl:"partials/profile.html",
controller:ProfileController});b.when("/export",{templateUrl:"partials/account-export.html",controller:ExportController});b.when("/import",{templateUrl:"partials/account-import.html",controller:ImportController});b.when("/settings",{templateUrl:"partials/account-settings.html",controller:AccountController});b.when("/about",{templateUrl:"partials/about.html",controller:AboutController});b.otherwise({redirectTo:"/friends-stuff"})}]);
angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])});
